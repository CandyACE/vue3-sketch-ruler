(function(U,r){typeof exports=="object"&&typeof module<"u"?r(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],r):(U=typeof globalThis<"u"?globalThis:U||self,r(U.SketchRuler={},U.vue))})(this,function(U,r){"use strict";/*!vue3-sketch-ruler v2.0.1-beta.02024年7月Wed Jul 10 2024 13:56:14 GMT+0800 (中国标准时间)制作*/const be={key:0,class:"value"},Ae=r.defineComponent({__name:"ruler-line",props:{scale:{},thick:{},palette:{},index:{},start:{},vertical:{type:Boolean},value:{},isShowReferLine:{type:Boolean}},emits:["onMouseDown","onRelease","onRemove"],setup(e,{emit:t}){const o=r.ref(0),n=e,f=t,u=r.ref(n.value),g=r.computed(()=>u.value>=n.start),w=r.computed(()=>{const A=(u.value-n.start)*n.scale;return n.vertical?{top:`${A}px`}:{left:`${A}px`}}),p=r.computed(()=>{var k;const A=((k=n.palette)==null?void 0:k.lineColor)??"black";return{cursor:n.isShowReferLine?n.vertical?"ns-resize":"ew-resize":"default",...n.vertical?{borderTop:`1px solid ${A}`}:{borderLeft:`1px solid ${A}`}}}),S=r.computed(()=>({[n.vertical?"left":"top"]:`${o.value}px`}));r.onMounted(()=>{u.value=n.value??0});function B(A){const k=n.vertical?A.clientY:A.clientX,O=u.value,x=Y=>{const z=((n.vertical?Y.clientY:Y.clientX)-k)/n.scale;u.value=Math.round(O+z),f("onMouseDown")};document.addEventListener("mousemove",x),document.addEventListener("mouseup",()=>{g.value||l(),document.removeEventListener("mousemove",x),f("onRelease",u.value,n.index)},{once:!0})}function l(){console.log("删除",n.index),f("onRemove",n.index)}const h=r.ref(!1),d=A=>{o.value=n.vertical?A.offsetX:A.offsetY},N=r.computed(()=>`${n.vertical?"Y":"X"}：${u.value}`);return(A,k)=>r.withDirectives((r.openBlock(),r.createElementBlock("div",{class:"line",style:r.normalizeStyle({...w.value,...p.value}),onMouseenter:k[0]||(k[0]=O=>h.value=!0),onMousemove:d,onMouseleave:k[1]||(k[1]=O=>h.value=!1),onMousedown:B},[r.createElementVNode("div",{class:"action",style:r.normalizeStyle(S.value)},[h.value?(r.openBlock(),r.createElementBlock("span",be,r.toDisplayString(N.value),1)):r.createCommentVNode("",!0)],4)],36)),[[r.vShow,g.value]])}}),ce=(e,t)=>{const o=e.__vccOpts||e;for(const[n,f]of t)o[n]=f;return o},Se=ce(Ae,[["__scopeId","data-v-aebb098c"]]),Ne=e=>e<=.25?40:e<=.5?20:e<=1?10:e<=2?5:e<=4?2:1,de=.83,Ee=(e,t,o,n,f,u)=>{const{scale:g,width:w,height:p,ratio:S,palette:B}=f,{bgColor:l,fontColor:h,shadowColor:d,longfgColor:N}=B,A=u?f.endNumX:f.endNumY;if(e.scale(S,S),e.clearRect(0,0,w,p),e.fillStyle=l,e.fillRect(0,0,w,p),n){const z=(o-t)*g,c=n*g;e.fillStyle=d,u?e.fillRect(z,0,c,p*3/8):e.fillRect(0,z,w*3/8,c)}const O=Ne(g)*10,x=O*g,Y=-t/O*x,I=t+Math.ceil((u?w:p)/g);e.beginPath(),e.fillStyle=h,e.strokeStyle=N;for(let z=0,c=0;z<I;z+=O,c++){if(z<=A){debugger;const E=Y+c*x;u?e.moveTo(E,0):e.moveTo(0,E),e.save(),u?e.translate(E,p*.4):e.translate(w*.4,E),u||e.rotate(-Math.PI/2),e.scale(de/S,de/S),e.fillText(z.toString(),4*S,7*S),e.restore(),u?e.lineTo(E,p*9/16):e.lineTo(w*9/16,E),console.log(E,"xBBBBBBBB")}e.stroke(),e.closePath(),e.setTransform(1,0,0,1,0,0)}},Ce=r.defineComponent({__name:"index",props:{showIndicator:{type:Boolean},valueNum:{},scale:{},ratio:{},palette:{},vertical:{},start:{},width:{},height:{},selectStart:{},selectLength:{},endNumX:{},endNumY:{}},emits:["onAddLine","update:showIndicator","update:valueNum"],setup(e,{emit:t}){const o=e,n=t,f=r.reactive({canvasContext:null});let u=1;const g=r.ref(null);r.onMounted(()=>{u=window.devicePixelRatio||1,window.addEventListener("resize",w),p(),S(u)});const w=()=>{u=window.devicePixelRatio||1,S(u),B(u)},p=()=>{f.canvasContext=g.value&&g.value.getContext("2d")};r.onUnmounted(()=>{window.removeEventListener("resize",w)});const S=h=>{if(g.value){g.value.width=o.width*h,g.value.height=o.height*h;const d=f.canvasContext;d&&(d.font=`${12*h}px -apple-system,
                "Helvetica Neue", ".SFNSText-Regular",
                "SF UI Text", Arial, "PingFang SC", "Hiragino Sans GB",
                "Microsoft YaHei", "WenQuanYi Zen Hei", sans-serif`,d.lineWidth=1,d.textBaseline="middle")}},B=h=>{console.log("drawRuler",o.scale);const d={scale:o.scale,width:o.width,height:o.height,palette:o.palette,endNumX:o.endNumX,endNumY:o.endNumY,ratio:h};f.canvasContext&&Ee(f.canvasContext,o.start,o.selectStart,o.selectLength,d,!o.vertical)};r.watch(()=>o.start,()=>{console.log("start",o.start),B(u)}),r.watch([()=>o.width,()=>o.height],()=>{S(u),B(u)});const l=(h,d)=>{const N=(O,x,Y)=>Math.round(x+O/Y),A=o.vertical?h.offsetY:h.offsetX,k=N(A,o.start,o.scale);switch(d){case"click":n("onAddLine",k);break;case"enter":n("update:valueNum",k),n("update:showIndicator",!0);break;default:n("update:valueNum",k);break}};return(h,d)=>(r.openBlock(),r.createElementBlock("canvas",{ref_key:"canvas",ref:g,class:"ruler",onClick:d[0]||(d[0]=N=>l(N,"click")),onMouseenter:d[1]||(d[1]=N=>l(N,"enter")),onMousemove:d[2]||(d[2]=N=>l(N,"move")),onMouseleave:d[3]||(d[3]=N=>h.$emit("update:showIndicator",!1))},null,544))}}),Be={scale:Number,ratio:Number,thick:Number,endNumX:Number,endNumY:Number,palette:Object,vertical:{type:Boolean,default:!0},width:{type:Number,default:200},height:{type:Number,default:200},start:{type:Number,default:0},lines:{type:Array,default:()=>[]},selectStart:{type:Number},selectLength:{type:Number},isShowReferLine:{type:Boolean}},ke={class:"lines"},Re={class:"value"},ue=ce(r.defineComponent({__name:"ruler-wrapper",props:Be,emits:["update:lines","on-remove-line"],setup(e,{emit:t}){const o=e,n=r.ref(!1),f=r.ref(0),u=r.computed(()=>o.vertical?"v-container":"h-container"),g=r.computed(()=>{const l={width:`calc(100% - ${o.thick}px)`,height:`${o.thick+1}px`,left:`${o.thick}px`},h={width:`${o.thick&&o.thick+1}px`,height:`calc(100% - ${o.thick}px)`,top:`${o.thick}px`};return o.vertical?h:l}),w=r.computed(()=>{var A;const l=(f.value-o.start)*o.scale;let h=o.vertical?"top":"left",d=o.vertical?"left":"top",N=o.vertical?"borderBottom":"borderLeft";return{[h]:l+"px",[d]:o.thick+"px",[N]:`1px solid ${(A=o.palette)==null?void 0:A.lineColor}`}}),p=l=>{o.lines.push(l)},S=(l,h)=>{const d=l-o.start,N=(o.vertical?o.height:o.width)/o.scale;d<0||d>N?B(h):o.lines[h]=l},B=l=>{o.lines.splice(l,1)};return(l,h)=>(r.openBlock(),r.createElementBlock("div",{class:r.normalizeClass(u.value),style:r.normalizeStyle(g.value)},[r.createVNode(Ce,{vertical:l.vertical,scale:l.scale,width:l.width,height:l.height,start:l.start,ratio:l.ratio,endNumX:l.endNumX,startNumY:l.startNumY,endNumY:l.endNumY,"select-start":l.selectStart,"select-length":l.selectLength,palette:l.palette,valueNum:f.value,"onUpdate:valueNum":h[0]||(h[0]=d=>f.value=d),showIndicator:n.value,"onUpdate:showIndicator":h[1]||(h[1]=d=>n.value=d),onOnAddLine:p},null,8,["vertical","scale","width","height","start","ratio","endNumX","startNumY","endNumY","select-start","select-length","palette","valueNum","showIndicator"]),r.withDirectives(r.createElementVNode("div",ke,[(r.openBlock(!0),r.createElementBlock(r.Fragment,null,r.renderList(l.lines,(d,N)=>(r.openBlock(),r.createBlock(Se,{key:d+N,index:N,value:d>>0,scale:l.scale,start:l.start,thick:l.thick,palette:l.palette,vertical:l.vertical,"is-show-refer-line":l.isShowReferLine,onOnRemove:B,onOnRelease:S},null,8,["index","value","scale","start","thick","palette","vertical","is-show-refer-line"]))),128))],512),[[r.vShow,l.isShowReferLine]]),r.withDirectives(r.createElementVNode("div",{class:"indicator",style:r.normalizeStyle(w.value)},[r.createElementVNode("div",Re,r.toDisplayString(f.value),1)],4),[[r.vShow,n.value]])],6))}}),[["__scopeId","data-v-41d371f8"]]),Xe="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABUAAAAVCAYAAACpF6WWAAAAAXNSR0IArs4c6QAAAopJREFUOE/FlE9IVEEcx7+/N9ouds1Mu0QUSFZYdIgoUqQoKPBQHsKozpXE7jbTO/U8xLJvn6usBHWQ6hBFXupSkQeVbh0KJEPp0sH+eLGTsKs77xcj78m0ax0E8cHjzZv5zef3/c33xxA24KENYGJzoEEQbNNaN4Zh2OQ4znwYhr9c1/39vwrXVDo0NNS0tLR0GYB5D64BmAMwzMyvlFKz1es10Hw+f4mZ7wHYBeA9gNdENFepVOaEEM3M3OI4Thczn41gt6WUgQ3+C+r7/h0AWQD3mXnYqPA8L9nQ0HCemduIaFpKOWoAhUJhT6VSuQXgOjP3K6W8GLwKzeVyp4jonR0QBEErM48w8zFLyayUsjX+z+VyHhHdZebTSqkxM78CHRgYOKS1/ghgVErZY214RkQ7ADyRUj72ff8qgCtmXUrZGcf5vv8CwEUhxOF0Ov1pBRpla5dSdseBhUJhpznH6tIsZb1KqacW+BGArUaUXX63UuplHJTNZjuEEONSyhozfd/n6mQ1RkXZL2itz7mu+80EDA4ONi8vL/8AcM2UbikyR2BU9cSmmTU70YqKIAj2hWFo2uenlHK/BRg3Y2aeNO5GyU8S0ZbFxcUuz/NKEXAGQKPjOCcymcyX1dIi8DSAiWQyeaavr68cbSgCuBknYubnQoj+TCYzUywWE6VS6S2ADsdx2gxw1X3L7SNENMbMnwE8qK+vf5NKpRaMaeVyeW8ikfiaSqW+R7BuZr5BRMe11p2u607U9Gk8kc/ntzPzQwCmExYATDLzVBiGE0KIowAOADDf3QA+aK2VDaxRajto3K+rq+tl5nYAzQBamHmeiOYBTGmtR6ph/1Rqg9c73pz7dD1qN0TpHyNQRCUDJXrAAAAAAElFTkSuQmCC",Oe="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABUAAAAVCAYAAACpF6WWAAAAAXNSR0IArs4c6QAAAjtJREFUOE/NlD9oFEEUxn9v9ghC0hpRUogIAUmniGAT/5Q2FrETPSNRJILg7RwimI0ox85eQFCEBGIUO1PYpFM0jSConQoBEZGgGPsgl+w+2eM2bC57SopAFqYZ3v7m+977ZoQt+GQLmGxPaBiGgYiMWWvXBHZUGoZhH3BERPYC+4F+4Keq/urt7b1RLpf/ZEBVHa9Wq0HWyg3QKIoGVPU8cA7wgK/pUtXPQJ8xZk+pVBpuNBqXUoUiEvi+P56fzTpo6+SbwHNg1lo7WzTITGEKXFlZeeB53tVCpa3CK8AFa+1cBgvD8LKIXAQOJkkyICJDeYVBEJS6u7s/qeoLa+1o+l9TqXNuBLhmjDlbqVQ+5ICjInIfOBPH8W9jzGCR5YmJiRNxHM+papgqzqDvgSlr7VTernPuO3An3c9bBt74vv+yrdaKyLDv+/1Sq9UGPc97nY9EVuycU2AQOA7cAm4Dr4D5TvVxHB9rKo2iaEFVp621Ln96FEUngaOqGmSxabVqsh3a2h+x1h5qQjNrae/yE4+iaCwDJkky73neTuBZe129Xk+H+BS4l7ZqLVIZ2BhzuFKpvMsDVXXWGPMxFdAedOfcKeCRqj7MYrUhpz09PfXl5eXrectFWXXODQHpOq2qd/95o/JXr6ura3J1dXU6SZIfwKKIHAD2tVYMPBGRx77vN10UXtO85fTkmZmZHUtLSzUR2QXsBhaAL6r6DXhbrVYXi1yss59GqOgub/bN3Z7v6X/tb9Zmp/q/kN8s+lJb8oEAAAAASUVORK5CYII=",Ye={eyeIcon:{type:String},closeEyeIcon:{type:String},scale:{type:Number,default:1},ratio:{type:Number},thick:{type:Number,default:16},palette:Object,startX:{type:Number},startY:{type:Number,default:0},width:{type:Number,default:200},height:{type:Number,default:200},shadow:{type:Object,default:()=>({x:0,y:0,width:0,height:0})},lines:{type:Object,default:()=>({h:[],v:[]})},isShowReferLine:{type:Boolean,default:!0},endNumX:{type:Number,default:1/0},endNumY:{type:Number,default:1/0},panzoomOption:Object};/*!simple-panzoom v1.0.12024年7月Sat Jul 06 2024 11:41:16 GMT+0800 (中国标准时间)制作*/typeof window<"u"&&(window.NodeList&&!NodeList.prototype.forEach&&(NodeList.prototype.forEach=Array.prototype.forEach),typeof window.CustomEvent!="function"&&(window.CustomEvent=function(e,t){t=t||{bubbles:!1,cancelable:!1,detail:null};var o=document.createEvent("CustomEvent");return o.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),o}));function pe(e,t){let o=e.length;for(;o--;)if(e[o].pointerId===t.pointerId)return o;return-1}function H(e,t){let o;if(t.touches){o=0;for(const n of t.touches)n.pointerId=o++,H(e,n);return}o=pe(e,t),o>-1&&e.splice(o,1),e.push(t)}function ze(e,t){if(t.touches){for(;e.length;)e.pop();return}const o=pe(e,t);o>-1&&e.splice(o,1)}function he(e){e=e.slice(0);let t=e.pop(),o;for(;o=e.pop();)t={clientX:(o.clientX-t.clientX)/2+t.clientX,clientY:(o.clientY-t.clientY)/2+t.clientY};return t}function j(e){if(e.length<2)return 0;const t=e[0],o=e[1];return Math.sqrt(Math.pow(Math.abs(o.clientX-t.clientX),2)+Math.pow(Math.abs(o.clientY-t.clientY),2))}let D={down:"mousedown",move:"mousemove",up:"mouseup mouseleave"};typeof window<"u"&&(typeof window.PointerEvent=="function"?D={down:"pointerdown",move:"pointermove",up:"pointerup pointerleave pointercancel"}:typeof window.TouchEvent=="function"&&(D={down:"touchstart",move:"touchmove",up:"touchend touchcancel"}));function J(e,t,o,n){D[e].split(" ").forEach(f=>{t.addEventListener(f,o,n)})}function _(e,t,o){D[e].split(" ").forEach(n=>{t.removeEventListener(n,o)})}const xe=typeof document<"u"&&!!document.documentMode;let me;function Me(){return me||(me=document.createElement("div").style)}const fe=["webkit","moz","ms"],Q={};function ee(e){if(Q[e])return Q[e];const t=Me();if(e in t)return Q[e]=e;const o=e[0].toUpperCase()+e.slice(1);let n=fe.length;for(;n--;){const f=`${fe[n]}${o}`;if(f in t)return Q[e]=f}}function q(e,t){return parseFloat(t[ee(e)])||0}function G(e,t,o=window.getComputedStyle(e)){const n=t==="border"?"Width":"";return{left:q(`${t}Left${n}`,o),right:q(`${t}Right${n}`,o),top:q(`${t}Top${n}`,o),bottom:q(`${t}Bottom${n}`,o)}}function T(e,t,o){e.style[ee(t)]=o}function Le(e,t){const o=ee("transform");T(e,"transition",`${o} ${t.duration}ms ${t.easing}`)}function Pe(e,{x:t,y:o,scale:n,isSVG:f},u){if(T(e,"transform",`scale(${n}) translate(${t}px, ${o}px)`),f&&xe){const g=window.getComputedStyle(e).getPropertyValue("transform");e.setAttribute("transform",g)}}function W(e){const t=e.parentNode,o=window.getComputedStyle(e),n=window.getComputedStyle(t),f=e.getBoundingClientRect(),u=t.getBoundingClientRect();return{elem:{style:o,width:f.width,height:f.height,top:f.top,bottom:f.bottom,left:f.left,right:f.right,margin:G(e,"margin",o),border:G(e,"border",o)},parent:{style:n,width:u.width,height:u.height,top:u.top,bottom:u.bottom,left:u.left,right:u.right,padding:G(t,"padding",n),border:G(t,"border",n)}}}function Ue(e){let t=e;for(;t&&t.parentNode;){if(t.parentNode===document)return!0;t=t.parentNode instanceof ShadowRoot?t.parentNode.host:t.parentNode}return!1}function Ie(e){return(e.getAttribute("class")||"").trim()}function Ve(e,t){return e.nodeType===1&&` ${Ie(e)} `.indexOf(` ${t} `)>-1}function $e(e,t){for(let o=e;o!=null;o=o.parentNode)if(Ve(o,t.excludeClass)||t.exclude.indexOf(o)>-1)return!0;return!1}const Te=/^http:[\w\.\/]+svg$/;function De(e){return Te.test(e.namespaceURI)&&e.nodeName.toLowerCase()!=="svg"}function Fe(e){const t={};for(const o in e)e.hasOwnProperty(o)&&(t[o]=e[o]);return t}const ge={animate:!1,canvas:!1,cursor:"move",disablePan:!1,disableZoom:!1,disableXAxis:!1,disableYAxis:!1,duration:200,easing:"ease-in-out",exclude:[],excludeClass:"panzoom-exclude",handleStartEvent:e=>{e.preventDefault(),e.stopPropagation()},maxScale:4,minScale:.125,overflow:"hidden",panOnlyWhenZoomed:!1,pinchAndPan:!1,relative:!1,setTransform:Pe,startX:0,startY:0,startScale:1,step:.3,touchAction:"none"};function ve(e,t){if(!e)throw new Error("Panzoom requires an element as an argument");if(e.nodeType!==1)throw new Error("Panzoom requires an element with a nodeType of 1");if(!Ue(e))throw new Error("Panzoom should be called on elements that have been attached to the DOM");t={...ge,...t};const o=De(e),n=e.parentNode;n.style.overflow=t.overflow,n.style.userSelect="none",n.style.touchAction=t.touchAction,(t.canvas?n:e).style.cursor=t.cursor,e.style.userSelect="none",e.style.touchAction=t.touchAction,T(e,"transformOrigin",typeof t.origin=="string"?t.origin:o?"0 0":"50% 50%");function f(){n.style.overflow="",n.style.userSelect="",n.style.touchAction="",n.style.cursor="",e.style.cursor="",e.style.userSelect="",e.style.touchAction="",T(e,"transformOrigin","")}function u(a={}){for(const s in a)a.hasOwnProperty(s)&&(t[s]=a[s]);(a.hasOwnProperty("cursor")||a.hasOwnProperty("canvas"))&&(n.style.cursor=e.style.cursor="",(t.canvas?n:e).style.cursor=t.cursor),a.hasOwnProperty("overflow")&&(n.style.overflow=a.overflow),a.hasOwnProperty("touchAction")&&(n.style.touchAction=a.touchAction,e.style.touchAction=a.touchAction)}let g=0,w=0,p=1,S=!1;A(t.startScale,{animate:!1,force:!0}),setTimeout(()=>{N(t.startX,t.startY,{animate:!1,force:!0})});function B(a,s,v){if(v.silent)return;const b=new CustomEvent(a,{detail:s});e.dispatchEvent(b)}function l(a,s,v){const b={x:g,y:w,scale:p,isSVG:o,originalEvent:v};typeof s.animate=="boolean"&&(s.animate?Le(e,s):T(e,"transition","none")),s.setTransform(e,b,s);function i(){const y=W(e);b.dimsOut=y,B(a,b,s),B("panzoomchange",b,s)}return s.animate?setTimeout(()=>{i()},s.duration+50):requestAnimationFrame(()=>{i()}),b}function h(a,s,v,b){const i={...t,...b},y={x:g,y:w,opts:i};if(!i.force&&(i.disablePan||i.panOnlyWhenZoomed&&p===i.startScale))return y;if(a=parseFloat(a),s=parseFloat(s),i.disableXAxis||(y.x=(i.relative?g:0)+a),i.disableYAxis||(y.y=(i.relative?w:0)+s),i.contain){const m=W(e),L=m.elem.width/p,M=m.elem.height/p,F=L*v,K=M*v,V=(F-L)/2,$=(K-M)/2;if(i.contain==="inside"){const ae=(-m.elem.margin.left-m.parent.padding.left+V)/v,ie=(m.parent.width-F-m.parent.padding.left-m.elem.margin.left-m.parent.border.left-m.parent.border.right+V)/v;y.x=Math.max(Math.min(y.x,ie),ae);const le=(-m.elem.margin.top-m.parent.padding.top+$)/v,se=(m.parent.height-K-m.parent.padding.top-m.elem.margin.top-m.parent.border.top-m.parent.border.bottom+$)/v;y.y=Math.max(Math.min(y.y,se),le)}else if(i.contain==="outside"){const ae=(-(F-m.parent.width)-m.parent.padding.left-m.parent.border.left-m.parent.border.right+V)/v,ie=(V-m.parent.padding.left)/v;y.x=Math.max(Math.min(y.x,ie),ae);const le=(-(K-m.parent.height)-m.parent.padding.top-m.parent.border.top-m.parent.border.bottom+$)/v,se=($-m.parent.padding.top)/v;y.y=Math.max(Math.min(y.y,se),le)}}return i.roundPixels&&(y.x=Math.round(y.x),y.y=Math.round(y.y)),y}function d(a,s){const v={...t,...s},b={scale:p,opts:v};if(!v.force&&v.disableZoom)return b;let i=t.minScale,y=t.maxScale;if(v.contain){const m=W(e),L=m.elem.width/p,M=m.elem.height/p;if(L>1&&M>1){const F=m.parent.width-m.parent.border.left-m.parent.border.right,K=m.parent.height-m.parent.border.top-m.parent.border.bottom,V=F/L,$=K/M;t.contain==="inside"?y=Math.min(y,V,$):t.contain==="outside"&&(i=Math.max(i,V,$))}}return b.scale=Math.min(Math.max(a,i),y),b}function N(a,s,v,b){const i=h(a,s,p,v);return g!==i.x||w!==i.y?(g=i.x,w=i.y,l("panzoompan",i.opts,b)):{x:g,y:w,scale:p,isSVG:o,originalEvent:b}}function A(a,s,v){const b=d(a,s),i=b.opts;if(!i.force&&i.disableZoom)return;a=b.scale;let y=g,m=w;if(i.focal){const M=i.focal;y=(M.x/a-M.x/p+g*a)/a,m=(M.y/a-M.y/p+w*a)/a}const L=h(y,m,a,{relative:!1,force:!0});return g=L.x,w=L.y,p=a,l("panzoomzoom",i,v)}function k(a,s){const v={...t,animate:!0,...s};return A(p*Math.exp((a?1:-1)*v.step),v)}function O(a){return k(!0,a)}function x(a){return k(!1,a)}function Y(a,s,v,b){const i=W(e),y={width:i.parent.width-i.parent.padding.left-i.parent.padding.right-i.parent.border.left-i.parent.border.right,height:i.parent.height-i.parent.padding.top-i.parent.padding.bottom-i.parent.border.top-i.parent.border.bottom};let m=s.clientX-i.parent.left-i.parent.padding.left-i.parent.border.left-i.elem.margin.left,L=s.clientY-i.parent.top-i.parent.padding.top-i.parent.border.top-i.elem.margin.top;o||(m-=i.elem.width/p/2,L-=i.elem.height/p/2);const M={x:m/y.width*(y.width*a),y:L/y.height*(y.height*a)};return A(a,{...v,animate:!1,focal:M},b)}function I(a,s){a.preventDefault();const v={...t,...s,animate:!1},b=(a.deltaY===0&&a.deltaX?a.deltaX:a.deltaY)<0?1:-1,i=d(p*Math.exp(b*v.step/3),v).scale;return Y(i,a,v,a)}function z(a){const s={...t,animate:!0,force:!0,...a};p=d(s.startScale,s).scale;const v=h(s.startX,s.startY,p,s);return g=v.x,w=v.y,l("panzoomreset",s)}let c,E,C,X,R,Z;const P=[];function te(a){if($e(a.target,t))return;H(P,a),S=!0,t.handleStartEvent(a),c=g,E=w,B("panzoomstart",{x:g,y:w,scale:p,isSVG:o,originalEvent:a},t);const s=he(P);C=s.clientX,X=s.clientY,R=p,Z=j(P)}function oe(a){if(!S||c===void 0||E===void 0||C===void 0||X===void 0)return;H(P,a);const s=he(P),v=P.length>1;let b=p;if(v){Z===0&&(Z=j(P));const i=j(P)-Z;b=d(i*t.step/80+R).scale,Y(b,s,{animate:!1},a)}(!v||t.pinchAndPan)&&N(c+(s.clientX-C)/b,E+(s.clientY-X)/b,{animate:!1},a)}function ne(a){P.length===1&&B("panzoomend",{x:g,y:w,scale:p,isSVG:o,originalEvent:a},t),ze(P,a),S&&(S=!1,c=E=C=X=void 0)}let re=!1;function ye(){re||(re=!0,J("down",t.canvas?n:e,te),J("move",document,oe,{passive:!0}),J("up",document,ne,{passive:!0}))}function qe(){re=!1,_("down",t.canvas?n:e,te),_("move",document,oe),_("up",document,ne)}return t.noBind||ye(),{bind:ye,destroy:qe,eventNames:D,getPan:()=>({x:g,y:w}),getScale:()=>p,getOptions:()=>Fe(t),handleDown:te,handleMove:oe,handleUp:ne,pan:N,reset:z,resetStyle:f,setOptions:u,setStyle:(a,s)=>T(e,a,s),zoom:A,zoomIn:O,zoomOut:x,zoomToPoint:Y,zoomWithWheel:I}}ve.defaultOptions=ge;const Ke={class:"sketch-ruler"},Qe={class:"canvasedit"},we=r.defineComponent({__name:"index",props:Ye,emits:["onCornerClick","update:scale"],setup(e,{expose:t,emit:o}){const n=e,f=o,u=r.ref(null),g=r.ref(0),w=r.ref(0),p=r.ref(0),S=r.ref(0),B=r.ref(1),l=r.ref(n.isShowReferLine),h=r.ref(null),d=r.computed(()=>{function c(C,X){return Object.keys(C).forEach(R=>{R&&C.hasOwnProperty(R)&&(typeof X[R]=="object"?C[R]=c(C[R],X[R]):X.hasOwnProperty(R)&&(C[R]=X[R]))}),C}return c({bgColor:"rgba(225,225,225, 0)",longfgColor:"#BABBBC",fontColor:"#7D8694",shadowColor:"#E8E8E8",lineColor:"#EB5648",borderColor:"#DADADC",cornerActiveColor:"rgb(235, 86, 72, 0.6)",menu:{bgColor:"#fff",dividerColor:"#DBDBDB",listItem:{textColor:"#415058",hoverTextColor:"#298DF8",disabledTextColor:"rgba(65, 80, 88, 0.4)",bgColor:"#fff",hoverBgColor:"#F2F2F2"}}},n.palette||{})}),N=r.computed(()=>({backgroundImage:l.value?`url(${n.eyeIcon||Xe})`:`url(${n.closeEyeIcon||Oe})`,width:n.thick+"px",height:n.thick+"px",borderRight:`1px solid ${d.value.borderColor}`,borderBottom:`1px solid ${d.value.borderColor}`})),A=r.computed(()=>({background:"#ff9",marginTop:n.thick+"px",marginLeft:n.thick+"px",width:n.width-n.thick+"px",height:n.height-n.thick+"px"}));r.onMounted(()=>{k()});const k=()=>{u.value=document.querySelector(".canvasedit"),O(),console.log(p.value,"zoomStartX.value"),console.log(S.value,"zoomStartY.value"),h.value=ve(u.value,{noBind:!0,startScale:n.scale,cursor:"default",startX:p.value,startY:S.value,smoothScroll:!0,...n.panzoomOption}),u.value.addEventListener("panzoomchange",c=>{const{scale:E,dimsOut:C}=c.detail;if(C){console.log(c.detail,"event.detail"),f("update:scale",E),B.value=E;const X=(C.parent.left-C.elem.left)/E,R=(C.parent.top-C.elem.top)/E;g.value=X,console.log(g.value*E,"startX.value"),console.log(E,"scale"),w.value=R}}),parent.addEventListener("wheel",function(c){(c.ctrlKey||c.metaKey)&&h.value.zoomWithWheel(c)}),parent.addEventListener("keydown",function(c){c.key===" "&&h.value.bind()}),parent.addEventListener("keyup",function(c){c.key===" "&&h.value.destroy()})},O=()=>{const E=document.querySelector(".canvasedit-parent").getBoundingClientRect(),C=u.value.children[0].getBoundingClientRect(),{width:X,height:R}=E;X>C.width?(p.value=(X-n.thick-C.width)/2,R>C.height?S.value=(R-n.thick-C.height)/2:S.value=0):(S.value=0,p.value=0)},x=()=>{h.value.reset()},Y=()=>{h.value.zoomIn()},I=()=>{h.value.zoomOut()},z=()=>{l.value=!l.value,f("onCornerClick",l.value)};return r.watch([()=>n.isShowReferLine],()=>{l.value=n.isShowReferLine}),t({panzoomInstance:h,reset:x,zoomIn:Y,zoomOut:I}),(c,E)=>(r.openBlock(),r.createElementBlock("div",Ke,[r.renderSlot(c.$slots,"btn",{reset:x,zoomIn:Y,zoomOut:I}),r.createElementVNode("div",{class:"canvasedit-parent",style:r.normalizeStyle(A.value),onWheel:E[0]||(E[0]=r.withModifiers(()=>{},["prevent"]))},[r.createElementVNode("div",Qe,[r.renderSlot(c.$slots,"default")])],36),r.createVNode(ue,{vertical:!1,width:c.width,height:c.thick,"is-show-refer-line":l.value,thick:c.thick,ratio:c.ratio,start:g.value,lines:c.lines.h,"select-start":c.shadow.x,"select-length":c.shadow.width,scale:B.value,palette:d.value,endNumX:c.endNumX},null,8,["width","height","is-show-refer-line","thick","ratio","start","lines","select-start","select-length","scale","palette","endNumX"]),r.createVNode(ue,{vertical:!0,width:c.thick,height:c.height,"is-show-refer-line":l.value,thick:c.thick,ratio:c.ratio,start:w.value,lines:c.lines.v,"select-start":c.shadow.y,"select-length":c.shadow.height,scale:B.value,palette:d.value,endNumY:c.endNumY},null,8,["width","height","is-show-refer-line","thick","ratio","start","lines","select-start","select-length","scale","palette","endNumY"]),r.createElementVNode("a",{class:"corner",style:r.normalizeStyle(N.value),onClick:z},null,4)]))}});U.SketchRule=we,U.default=we,Object.defineProperties(U,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
