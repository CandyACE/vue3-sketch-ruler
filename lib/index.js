"use strict";/*!vue3-sketch-ruler v2.0.12024年7月Tue Jul 09 2024 23:07:11 GMT+0800 (中国标准时间)制作*/Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const r=require("vue"),be={key:0,class:"value"},Ne=r.defineComponent({__name:"ruler-line",props:{scale:{},thick:{},palette:{},index:{},start:{},vertical:{type:Boolean},value:{},isShowReferLine:{type:Boolean}},emits:["onMouseDown","onRelease","onRemove"],setup(e,{emit:o}){const t=r.ref(0),n=e,h=o,m=r.ref(n.value),f=r.computed(()=>m.value>=n.start),w=r.computed(()=>{const N=(m.value-n.start)*n.scale;return n.vertical?{top:`${N}px`}:{left:`${N}px`}}),d=r.computed(()=>{var X;const N=((X=n.palette)==null?void 0:X.lineColor)??"black";return{cursor:n.isShowReferLine?n.vertical?"ns-resize":"ew-resize":"default",...n.vertical?{borderTop:`1px solid ${N}`}:{borderLeft:`1px solid ${N}`}}}),S=r.computed(()=>({[n.vertical?"left":"top"]:`${t.value}px`}));r.onMounted(()=>{m.value=n.value??0});function C(N){const X=n.vertical?N.clientY:N.clientX,x=m.value,R=O=>{const I=((n.vertical?O.clientY:O.clientX)-X)/n.scale;m.value=Math.round(x+I),h("onMouseDown")};document.addEventListener("mousemove",R),document.addEventListener("mouseup",()=>{f.value||l(),document.removeEventListener("mousemove",R),h("onRelease",m.value,n.index)},{once:!0})}function l(){console.log("删除",n.index),h("onRemove",n.index)}const u=r.ref(!1),g=N=>{t.value=n.vertical?N.offsetX:N.offsetY},B=r.computed(()=>`${n.vertical?"Y":"X"}：${m.value}`);return(N,X)=>r.withDirectives((r.openBlock(),r.createElementBlock("div",{class:"line",style:r.normalizeStyle({...w.value,...d.value}),onMouseenter:X[0]||(X[0]=x=>u.value=!0),onMousemove:g,onMouseleave:X[1]||(X[1]=x=>u.value=!1),onMousedown:C},[r.createElementVNode("div",{class:"action",style:r.normalizeStyle(S.value)},[u.value?(r.openBlock(),r.createElementBlock("span",be,r.toDisplayString(B.value),1)):r.createCommentVNode("",!0)],4)],36)),[[r.vShow,f.value]])}}),me=(e,o)=>{const t=e.__vccOpts||e;for(const[n,h]of o)t[n]=h;return t},Ae=me(Ne,[["__scopeId","data-v-aebb098c"]]),Se=e=>e<=.25?40:e<=.5?20:e<=1?10:e<=2?5:e<=4?2:1,ce=.83,Ee=(e,o,t,n,h,m)=>{const{scale:f,width:w,height:d,ratio:S,palette:C}=h,{bgColor:l,fontColor:u,shadowColor:g,longfgColor:B}=C,N=m?h.startNumX:h.startNumY,X=m?h.endNumX:h.endNumY;if(e.scale(S,S),e.clearRect(0,0,w,d),e.fillStyle=l,e.fillRect(0,0,w,d),n){const s=(t-o)*f,E=n*f;e.fillStyle=g,m?e.fillRect(s,0,E,d*3/8):e.fillRect(0,s,w*3/8,E)}const R=Se(f)*10,O=R*f,P=-o/R*O,I=o+Math.ceil((m?w:d)/f);e.beginPath(),e.fillStyle=u,e.strokeStyle=B;for(let s=0,E=0;s<I;s+=R,E++){if(s>=N&&s<=X){debugger;const y=P+E*O;m?e.moveTo(y,0):e.moveTo(0,y),e.save(),m?e.translate(y,d*.4):e.translate(w*.4,y),m||e.rotate(-Math.PI/2),e.scale(ce/S,ce/S),e.fillText(s.toString(),4*S,7*S),e.restore(),m?e.lineTo(y,d*9/16):e.lineTo(w*9/16,y),console.log(y,"xBBBBBBBB")}e.stroke(),e.closePath(),e.setTransform(1,0,0,1,0,0)}},Ce=r.defineComponent({__name:"index",props:{showIndicator:{type:Boolean},valueNum:{},scale:{},ratio:{},palette:{},vertical:{},start:{},width:{},height:{},selectStart:{},selectLength:{},startNumX:{},endNumX:{},startNumY:{},endNumY:{}},emits:["onAddLine","update:showIndicator","update:valueNum"],setup(e,{emit:o}){const t=e,n=o,h=r.reactive({canvasContext:null});let m=1;const f=r.ref(null);r.onMounted(()=>{m=t.ratio||window.devicePixelRatio||1,w(),d(m)});const w=()=>{h.canvasContext=f.value&&f.value.getContext("2d")},d=l=>{if(f.value){f.value.width=t.width*l,f.value.height=t.height*l;const u=h.canvasContext;u&&(u.font=`${12*l}px -apple-system,
                "Helvetica Neue", ".SFNSText-Regular",
                "SF UI Text", Arial, "PingFang SC", "Hiragino Sans GB",
                "Microsoft YaHei", "WenQuanYi Zen Hei", sans-serif`,u.lineWidth=1,u.textBaseline="middle")}},S=l=>{console.log("drawRuler",t.scale);const u={scale:t.scale,width:t.width,height:t.height,palette:t.palette,startNumX:t.startNumX,endNumX:t.endNumX,startNumY:t.startNumY,endNumY:t.endNumY,ratio:l};h.canvasContext&&Ee(h.canvasContext,t.start,t.selectStart,t.selectLength,u,!t.vertical)};r.watch(()=>t.start,()=>{console.log("start",t.start),S(m)}),r.watch([()=>t.width,()=>t.height],()=>{d(m),S(m)});const C=(l,u)=>{const g=(X,x,R)=>Math.round(x+X/R),B=t.vertical?l.offsetY:l.offsetX,N=g(B,t.start,t.scale);switch(u){case"click":n("onAddLine",N);break;case"enter":n("update:valueNum",N),n("update:showIndicator",!0);break;default:n("update:valueNum",N);break}};return(l,u)=>(r.openBlock(),r.createElementBlock("canvas",{ref_key:"canvas",ref:f,class:"ruler",onClick:u[0]||(u[0]=g=>C(g,"click")),onMouseenter:u[1]||(u[1]=g=>C(g,"enter")),onMousemove:u[2]||(u[2]=g=>C(g,"move")),onMouseleave:u[3]||(u[3]=g=>l.$emit("update:showIndicator",!1))},null,544))}}),Be={scale:Number,ratio:Number,thick:Number,startNumX:Number,endNumX:Number,startNumY:Number,endNumY:Number,palette:Object,vertical:{type:Boolean,default:!0},width:{type:Number,default:200},height:{type:Number,default:200},start:{type:Number,default:0},lines:{type:Array,default:()=>[]},selectStart:{type:Number},selectLength:{type:Number},isShowReferLine:{type:Boolean}},Xe={class:"lines"},ke={class:"value"},Ye=r.defineComponent({__name:"ruler-wrapper",props:Be,emits:["update:lines","on-remove-line"],setup(e,{emit:o}){const t=e,n=r.ref(!1),h=r.ref(0),m=r.computed(()=>t.vertical?"v-container":"h-container"),f=r.computed(()=>{const l={width:`calc(100% - ${t.thick}px)`,height:`${t.thick+1}px`,left:`${t.thick}px`},u={width:`${t.thick&&t.thick+1}px`,height:`calc(100% - ${t.thick}px)`,top:`${t.thick}px`};return t.vertical?u:l}),w=r.computed(()=>{var N;const l=(h.value-t.start)*t.scale;let u=t.vertical?"top":"left",g=t.vertical?"left":"top",B=t.vertical?"borderBottom":"borderLeft";return{[u]:l+"px",[g]:t.thick+"px",[B]:`1px solid ${(N=t.palette)==null?void 0:N.lineColor}`}}),d=l=>{t.lines.push(l)},S=(l,u)=>{const g=l-t.start,B=(t.vertical?t.height:t.width)/t.scale;g<0||g>B?C(u):t.lines[u]=l},C=l=>{t.lines.splice(l,1)};return(l,u)=>(r.openBlock(),r.createElementBlock("div",{class:r.normalizeClass(m.value),style:r.normalizeStyle(f.value)},[r.createVNode(Ce,{vertical:l.vertical,scale:l.scale,width:l.width,height:l.height,start:l.start,ratio:l.ratio,startNumX:l.startNumX,endNumX:l.endNumX,startNumY:l.startNumY,endNumY:l.endNumY,"select-start":l.selectStart,"select-length":l.selectLength,palette:l.palette,valueNum:h.value,"onUpdate:valueNum":u[0]||(u[0]=g=>h.value=g),showIndicator:n.value,"onUpdate:showIndicator":u[1]||(u[1]=g=>n.value=g),onOnAddLine:d},null,8,["vertical","scale","width","height","start","ratio","startNumX","endNumX","startNumY","endNumY","select-start","select-length","palette","valueNum","showIndicator"]),r.withDirectives(r.createElementVNode("div",Xe,[(r.openBlock(!0),r.createElementBlock(r.Fragment,null,r.renderList(l.lines,(g,B)=>(r.openBlock(),r.createBlock(Ae,{key:g+B,index:B,value:g>>0,scale:l.scale,start:l.start,thick:l.thick,palette:l.palette,vertical:l.vertical,"is-show-refer-line":l.isShowReferLine,onOnRemove:C,onOnRelease:S},null,8,["index","value","scale","start","thick","palette","vertical","is-show-refer-line"]))),128))],512),[[r.vShow,l.isShowReferLine]]),r.withDirectives(r.createElementVNode("div",{class:"indicator",style:r.normalizeStyle(w.value)},[r.createElementVNode("div",ke,r.toDisplayString(h.value),1)],4),[[r.vShow,n.value]])],6))}}),ue=me(Ye,[["__scopeId","data-v-67235dc7"]]),Re="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABUAAAAVCAYAAACpF6WWAAAAAXNSR0IArs4c6QAAAopJREFUOE/FlE9IVEEcx7+/N9ouds1Mu0QUSFZYdIgoUqQoKPBQHsKozpXE7jbTO/U8xLJvn6usBHWQ6hBFXupSkQeVbh0KJEPp0sH+eLGTsKs77xcj78m0ax0E8cHjzZv5zef3/c33xxA24KENYGJzoEEQbNNaN4Zh2OQ4znwYhr9c1/39vwrXVDo0NNS0tLR0GYB5D64BmAMwzMyvlFKz1es10Hw+f4mZ7wHYBeA9gNdENFepVOaEEM3M3OI4Thczn41gt6WUgQ3+C+r7/h0AWQD3mXnYqPA8L9nQ0HCemduIaFpKOWoAhUJhT6VSuQXgOjP3K6W8GLwKzeVyp4jonR0QBEErM48w8zFLyayUsjX+z+VyHhHdZebTSqkxM78CHRgYOKS1/ghgVErZY214RkQ7ADyRUj72ff8qgCtmXUrZGcf5vv8CwEUhxOF0Ov1pBRpla5dSdseBhUJhpznH6tIsZb1KqacW+BGArUaUXX63UuplHJTNZjuEEONSyhozfd/n6mQ1RkXZL2itz7mu+80EDA4ONi8vL/8AcM2UbikyR2BU9cSmmTU70YqKIAj2hWFo2uenlHK/BRg3Y2aeNO5GyU8S0ZbFxcUuz/NKEXAGQKPjOCcymcyX1dIi8DSAiWQyeaavr68cbSgCuBknYubnQoj+TCYzUywWE6VS6S2ADsdx2gxw1X3L7SNENMbMnwE8qK+vf5NKpRaMaeVyeW8ikfiaSqW+R7BuZr5BRMe11p2u607U9Gk8kc/ntzPzQwCmExYATDLzVBiGE0KIowAOADDf3QA+aK2VDaxRajto3K+rq+tl5nYAzQBamHmeiOYBTGmtR6ph/1Rqg9c73pz7dD1qN0TpHyNQRCUDJXrAAAAAAElFTkSuQmCC",Oe="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABUAAAAVCAYAAACpF6WWAAAAAXNSR0IArs4c6QAAAjtJREFUOE/NlD9oFEEUxn9v9ghC0hpRUogIAUmniGAT/5Q2FrETPSNRJILg7RwimI0ox85eQFCEBGIUO1PYpFM0jSConQoBEZGgGPsgl+w+2eM2bC57SopAFqYZ3v7m+977ZoQt+GQLmGxPaBiGgYiMWWvXBHZUGoZhH3BERPYC+4F+4Keq/urt7b1RLpf/ZEBVHa9Wq0HWyg3QKIoGVPU8cA7wgK/pUtXPQJ8xZk+pVBpuNBqXUoUiEvi+P56fzTpo6+SbwHNg1lo7WzTITGEKXFlZeeB53tVCpa3CK8AFa+1cBgvD8LKIXAQOJkkyICJDeYVBEJS6u7s/qeoLa+1o+l9TqXNuBLhmjDlbqVQ+5ICjInIfOBPH8W9jzGCR5YmJiRNxHM+papgqzqDvgSlr7VTernPuO3An3c9bBt74vv+yrdaKyLDv+/1Sq9UGPc97nY9EVuycU2AQOA7cAm4Dr4D5TvVxHB9rKo2iaEFVp621Ln96FEUngaOqGmSxabVqsh3a2h+x1h5qQjNrae/yE4+iaCwDJkky73neTuBZe129Xk+H+BS4l7ZqLVIZ2BhzuFKpvMsDVXXWGPMxFdAedOfcKeCRqj7MYrUhpz09PfXl5eXrectFWXXODQHpOq2qd/95o/JXr6ura3J1dXU6SZIfwKKIHAD2tVYMPBGRx77vN10UXtO85fTkmZmZHUtLSzUR2QXsBhaAL6r6DXhbrVYXi1yss59GqOgub/bN3Z7v6X/tb9Zmp/q/kN8s+lJb8oEAAAAASUVORK5CYII=",Me={eyeIcon:{type:String},closeEyeIcon:{type:String},scale:{type:Number,default:1},ratio:{type:Number},thick:{type:Number,default:16},palette:Object,startX:{type:Number},startY:{type:Number,default:0},width:{type:Number,default:200},height:{type:Number,default:200},shadow:{type:Object,default:()=>({x:0,y:0,width:0,height:0})},lines:{type:Object,default:()=>({h:[],v:[]})},isShowReferLine:{type:Boolean,default:!0},startNumX:{type:Number,default:-1/0},endNumX:{type:Number,default:1/0},startNumY:{type:Number,default:-1/0},endNumY:{type:Number,default:1/0},panzoomOption:Object};/*!simple-panzoom v1.0.12024年7月Sat Jul 06 2024 11:41:16 GMT+0800 (中国标准时间)制作*/typeof window<"u"&&(window.NodeList&&!NodeList.prototype.forEach&&(NodeList.prototype.forEach=Array.prototype.forEach),typeof window.CustomEvent!="function"&&(window.CustomEvent=function(e,o){o=o||{bubbles:!1,cancelable:!1,detail:null};var t=document.createEvent("CustomEvent");return t.initCustomEvent(e,o.bubbles,o.cancelable,o.detail),t}));function fe(e,o){let t=e.length;for(;t--;)if(e[t].pointerId===o.pointerId)return t;return-1}function le(e,o){let t;if(o.touches){t=0;for(const n of o.touches)n.pointerId=t++,le(e,n);return}t=fe(e,o),t>-1&&e.splice(t,1),e.push(o)}function ze(e,o){if(o.touches){for(;e.length;)e.pop();return}const t=fe(e,o);t>-1&&e.splice(t,1)}function de(e){e=e.slice(0);let o=e.pop(),t;for(;t=e.pop();)o={clientX:(t.clientX-o.clientX)/2+o.clientX,clientY:(t.clientY-o.clientY)/2+o.clientY};return o}function ne(e){if(e.length<2)return 0;const o=e[0],t=e[1];return Math.sqrt(Math.pow(Math.abs(t.clientX-o.clientX),2)+Math.pow(Math.abs(t.clientY-o.clientY),2))}let F={down:"mousedown",move:"mousemove",up:"mouseup mouseleave"};typeof window<"u"&&(typeof window.PointerEvent=="function"?F={down:"pointerdown",move:"pointermove",up:"pointerup pointerleave pointercancel"}:typeof window.TouchEvent=="function"&&(F={down:"touchstart",move:"touchmove",up:"touchend touchcancel"}));function re(e,o,t,n){F[e].split(" ").forEach(h=>{o.addEventListener(h,t,n)})}function ae(e,o,t){F[e].split(" ").forEach(n=>{o.removeEventListener(n,t)})}const xe=typeof document<"u"&&!!document.documentMode;let pe;function Le(){return pe||(pe=document.createElement("div").style)}const he=["webkit","moz","ms"],Q={};function ie(e){if(Q[e])return Q[e];const o=Le();if(e in o)return Q[e]=e;const t=e[0].toUpperCase()+e.slice(1);let n=he.length;for(;n--;){const h=`${he[n]}${t}`;if(h in o)return Q[e]=h}}function q(e,o){return parseFloat(o[ie(e)])||0}function G(e,o,t=window.getComputedStyle(e)){const n=o==="border"?"Width":"";return{left:q(`${o}Left${n}`,t),right:q(`${o}Right${n}`,t),top:q(`${o}Top${n}`,t),bottom:q(`${o}Bottom${n}`,t)}}function $(e,o,t){e.style[ie(o)]=t}function Pe(e,o){const t=ie("transform");$(e,"transition",`${t} ${o.duration}ms ${o.easing}`)}function Ie(e,{x:o,y:t,scale:n,isSVG:h},m){if($(e,"transform",`scale(${n}) translate(${o}px, ${t}px)`),h&&xe){const f=window.getComputedStyle(e).getPropertyValue("transform");e.setAttribute("transform",f)}}function W(e){const o=e.parentNode,t=window.getComputedStyle(e),n=window.getComputedStyle(o),h=e.getBoundingClientRect(),m=o.getBoundingClientRect();return{elem:{style:t,width:h.width,height:h.height,top:h.top,bottom:h.bottom,left:h.left,right:h.right,margin:G(e,"margin",t),border:G(e,"border",t)},parent:{style:n,width:m.width,height:m.height,top:m.top,bottom:m.bottom,left:m.left,right:m.right,padding:G(o,"padding",n),border:G(o,"border",n)}}}function Ue(e){let o=e;for(;o&&o.parentNode;){if(o.parentNode===document)return!0;o=o.parentNode instanceof ShadowRoot?o.parentNode.host:o.parentNode}return!1}function Ve(e){return(e.getAttribute("class")||"").trim()}function $e(e,o){return e.nodeType===1&&` ${Ve(e)} `.indexOf(` ${o} `)>-1}function De(e,o){for(let t=e;t!=null;t=t.parentNode)if($e(t,o.excludeClass)||o.exclude.indexOf(t)>-1)return!0;return!1}const Te=/^http:[\w\.\/]+svg$/;function Fe(e){return Te.test(e.namespaceURI)&&e.nodeName.toLowerCase()!=="svg"}function Ke(e){const o={};for(const t in e)e.hasOwnProperty(t)&&(o[t]=e[t]);return o}const ve={animate:!1,canvas:!1,cursor:"move",disablePan:!1,disableZoom:!1,disableXAxis:!1,disableYAxis:!1,duration:200,easing:"ease-in-out",exclude:[],excludeClass:"panzoom-exclude",handleStartEvent:e=>{e.preventDefault(),e.stopPropagation()},maxScale:4,minScale:.125,overflow:"hidden",panOnlyWhenZoomed:!1,pinchAndPan:!1,relative:!1,setTransform:Ie,startX:0,startY:0,startScale:1,step:.3,touchAction:"none"};function ge(e,o){if(!e)throw new Error("Panzoom requires an element as an argument");if(e.nodeType!==1)throw new Error("Panzoom requires an element with a nodeType of 1");if(!Ue(e))throw new Error("Panzoom should be called on elements that have been attached to the DOM");o={...ve,...o};const t=Fe(e),n=e.parentNode;n.style.overflow=o.overflow,n.style.userSelect="none",n.style.touchAction=o.touchAction,(o.canvas?n:e).style.cursor=o.cursor,e.style.userSelect="none",e.style.touchAction=o.touchAction,$(e,"transformOrigin",typeof o.origin=="string"?o.origin:t?"0 0":"50% 50%");function h(){n.style.overflow="",n.style.userSelect="",n.style.touchAction="",n.style.cursor="",e.style.cursor="",e.style.userSelect="",e.style.touchAction="",$(e,"transformOrigin","")}function m(a={}){for(const c in a)a.hasOwnProperty(c)&&(o[c]=a[c]);(a.hasOwnProperty("cursor")||a.hasOwnProperty("canvas"))&&(n.style.cursor=e.style.cursor="",(o.canvas?n:e).style.cursor=o.cursor),a.hasOwnProperty("overflow")&&(n.style.overflow=a.overflow),a.hasOwnProperty("touchAction")&&(n.style.touchAction=a.touchAction,e.style.touchAction=a.touchAction)}let f=0,w=0,d=1,S=!1;N(o.startScale,{animate:!1,force:!0}),setTimeout(()=>{B(o.startX,o.startY,{animate:!1,force:!0})});function C(a,c,v){if(v.silent)return;const A=new CustomEvent(a,{detail:c});e.dispatchEvent(A)}function l(a,c,v){const A={x:f,y:w,scale:d,isSVG:t,originalEvent:v};typeof c.animate=="boolean"&&(c.animate?Pe(e,c):$(e,"transition","none")),c.setTransform(e,A,c);function i(){const b=W(e);A.dimsOut=b,C(a,A,c),C("panzoomchange",A,c)}return c.animate?setTimeout(()=>{i()},c.duration+50):requestAnimationFrame(()=>{i()}),A}function u(a,c,v,A){const i={...o,...A},b={x:f,y:w,opts:i};if(!i.force&&(i.disablePan||i.panOnlyWhenZoomed&&d===i.startScale))return b;if(a=parseFloat(a),c=parseFloat(c),i.disableXAxis||(b.x=(i.relative?f:0)+a),i.disableYAxis||(b.y=(i.relative?w:0)+c),i.contain){const p=W(e),z=p.elem.width/d,M=p.elem.height/d,D=z*v,T=M*v,U=(D-z)/2,V=(T-M)/2;if(i.contain==="inside"){const _=(-p.elem.margin.left-p.parent.padding.left+U)/v,ee=(p.parent.width-D-p.parent.padding.left-p.elem.margin.left-p.parent.border.left-p.parent.border.right+U)/v;b.x=Math.max(Math.min(b.x,ee),_);const te=(-p.elem.margin.top-p.parent.padding.top+V)/v,oe=(p.parent.height-T-p.parent.padding.top-p.elem.margin.top-p.parent.border.top-p.parent.border.bottom+V)/v;b.y=Math.max(Math.min(b.y,oe),te)}else if(i.contain==="outside"){const _=(-(D-p.parent.width)-p.parent.padding.left-p.parent.border.left-p.parent.border.right+U)/v,ee=(U-p.parent.padding.left)/v;b.x=Math.max(Math.min(b.x,ee),_);const te=(-(T-p.parent.height)-p.parent.padding.top-p.parent.border.top-p.parent.border.bottom+V)/v,oe=(V-p.parent.padding.top)/v;b.y=Math.max(Math.min(b.y,oe),te)}}return i.roundPixels&&(b.x=Math.round(b.x),b.y=Math.round(b.y)),b}function g(a,c){const v={...o,...c},A={scale:d,opts:v};if(!v.force&&v.disableZoom)return A;let i=o.minScale,b=o.maxScale;if(v.contain){const p=W(e),z=p.elem.width/d,M=p.elem.height/d;if(z>1&&M>1){const D=p.parent.width-p.parent.border.left-p.parent.border.right,T=p.parent.height-p.parent.border.top-p.parent.border.bottom,U=D/z,V=T/M;o.contain==="inside"?b=Math.min(b,U,V):o.contain==="outside"&&(i=Math.max(i,U,V))}}return A.scale=Math.min(Math.max(a,i),b),A}function B(a,c,v,A){const i=u(a,c,d,v);return f!==i.x||w!==i.y?(f=i.x,w=i.y,l("panzoompan",i.opts,A)):{x:f,y:w,scale:d,isSVG:t,originalEvent:A}}function N(a,c,v){const A=g(a,c),i=A.opts;if(!i.force&&i.disableZoom)return;a=A.scale;let b=f,p=w;if(i.focal){const M=i.focal;b=(M.x/a-M.x/d+f*a)/a,p=(M.y/a-M.y/d+w*a)/a}const z=u(b,p,a,{relative:!1,force:!0});return f=z.x,w=z.y,d=a,l("panzoomzoom",i,v)}function X(a,c){const v={...o,animate:!0,...c};return N(d*Math.exp((a?1:-1)*v.step),v)}function x(a){return X(!0,a)}function R(a){return X(!1,a)}function O(a,c,v,A){const i=W(e),b={width:i.parent.width-i.parent.padding.left-i.parent.padding.right-i.parent.border.left-i.parent.border.right,height:i.parent.height-i.parent.padding.top-i.parent.padding.bottom-i.parent.border.top-i.parent.border.bottom};let p=c.clientX-i.parent.left-i.parent.padding.left-i.parent.border.left-i.elem.margin.left,z=c.clientY-i.parent.top-i.parent.padding.top-i.parent.border.top-i.elem.margin.top;t||(p-=i.elem.width/d/2,z-=i.elem.height/d/2);const M={x:p/b.width*(b.width*a),y:z/b.height*(b.height*a)};return N(a,{...v,animate:!1,focal:M},A)}function P(a,c){a.preventDefault();const v={...o,...c,animate:!1},A=(a.deltaY===0&&a.deltaX?a.deltaX:a.deltaY)<0?1:-1,i=g(d*Math.exp(A*v.step/3),v).scale;return O(i,a,v,a)}function I(a){const c={...o,animate:!0,force:!0,...a};d=g(c.startScale,c).scale;const v=u(c.startX,c.startY,d,c);return f=v.x,w=v.y,l("panzoomreset",c)}let s,E,y,Y,k,K;const L=[];function Z(a){if(De(a.target,o))return;le(L,a),S=!0,o.handleStartEvent(a),s=f,E=w,C("panzoomstart",{x:f,y:w,scale:d,isSVG:t,originalEvent:a},o);const c=de(L);y=c.clientX,Y=c.clientY,k=d,K=ne(L)}function H(a){if(!S||s===void 0||E===void 0||y===void 0||Y===void 0)return;le(L,a);const c=de(L),v=L.length>1;let A=d;if(v){K===0&&(K=ne(L));const i=ne(L)-K;A=g(i*o.step/80+k).scale,O(A,c,{animate:!1},a)}(!v||o.pinchAndPan)&&B(s+(c.clientX-y)/A,E+(c.clientY-Y)/A,{animate:!1},a)}function j(a){L.length===1&&C("panzoomend",{x:f,y:w,scale:d,isSVG:t,originalEvent:a},o),ze(L,a),S&&(S=!1,s=E=y=Y=void 0)}let J=!1;function se(){J||(J=!0,re("down",o.canvas?n:e,Z),re("move",document,H,{passive:!0}),re("up",document,j,{passive:!0}))}function ye(){J=!1,ae("down",o.canvas?n:e,Z),ae("move",document,H),ae("up",document,j)}return o.noBind||se(),{bind:se,destroy:ye,eventNames:F,getPan:()=>({x:f,y:w}),getScale:()=>d,getOptions:()=>Ke(o),handleDown:Z,handleMove:H,handleUp:j,pan:B,reset:I,resetStyle:h,setOptions:m,setStyle:(a,c)=>$(e,a,c),zoom:N,zoomIn:x,zoomOut:R,zoomToPoint:O,zoomWithWheel:P}}ge.defaultOptions=ve;const Qe={class:"sketch-ruler"},qe={class:"canvasedit"},we=r.defineComponent({__name:"index",props:Me,emits:["onCornerClick","update:scale"],setup(e,{expose:o,emit:t}){const n=e,h=t,m=r.ref(null),f=r.ref(0),w=r.ref(0),d=r.ref(0),S=r.ref(0),C=r.ref(1),l=r.ref(n.isShowReferLine),u=r.ref(null),g=r.computed(()=>{function s(y,Y){return Object.keys(y).forEach(k=>{k&&y.hasOwnProperty(k)&&(typeof Y[k]=="object"?y[k]=s(y[k],Y[k]):Y.hasOwnProperty(k)&&(y[k]=Y[k]))}),y}return s({bgColor:"rgba(225,225,225, 0)",longfgColor:"#BABBBC",fontColor:"#7D8694",shadowColor:"#E8E8E8",lineColor:"#EB5648",borderColor:"#DADADC",cornerActiveColor:"rgb(235, 86, 72, 0.6)",menu:{bgColor:"#fff",dividerColor:"#DBDBDB",listItem:{textColor:"#415058",hoverTextColor:"#298DF8",disabledTextColor:"rgba(65, 80, 88, 0.4)",bgColor:"#fff",hoverBgColor:"#F2F2F2"}}},n.palette||{})}),B=r.computed(()=>({backgroundImage:l.value?`url(${n.eyeIcon||Re})`:`url(${n.closeEyeIcon||Oe})`,width:n.thick+"px",height:n.thick+"px",borderRight:`1px solid ${g.value.borderColor}`,borderBottom:`1px solid ${g.value.borderColor}`})),N=r.computed(()=>({background:"#ff9",marginTop:n.thick+"px",marginLeft:n.thick+"px",width:n.width-n.thick+"px",height:n.height-n.thick+"px"}));r.onMounted(()=>{X()});const X=()=>{m.value=document.querySelector(".canvasedit"),x(),console.log(d.value,"zoomStartX.value"),console.log(S.value,"zoomStartY.value"),u.value=ge(m.value,{noBind:!0,startScale:n.scale,cursor:"default",startX:d.value,startY:S.value,smoothScroll:!0,...n.panzoomOption}),m.value.addEventListener("panzoomchange",s=>{const{scale:E,dimsOut:y}=s.detail;if(y){console.log(s.detail,"event.detail"),h("update:scale",E),C.value=E;const Y=(y.parent.left-y.elem.left)/E,k=(y.parent.top-y.elem.top)/E;f.value=Y,console.log(f.value*E,"startX.value"),console.log(E,"scale"),w.value=k}}),parent.addEventListener("wheel",function(s){(s.ctrlKey||s.metaKey)&&u.value.zoomWithWheel(s)}),parent.addEventListener("keydown",function(s){s.key===" "&&u.value.bind()}),parent.addEventListener("keyup",function(s){s.key===" "&&u.value.destroy()})},x=()=>{const E=document.querySelector(".canvasedit-parent").getBoundingClientRect(),y=m.value.children[0].getBoundingClientRect(),{width:Y,height:k}=E;Y>y.width?(d.value=(Y-n.thick-y.width)/2,k>y.height?S.value=(k-n.thick-y.height)/2:S.value=0):(S.value=0,d.value=0)},R=()=>{u.value.reset()},O=()=>{u.value.zoomIn()},P=()=>{u.value.zoomOut()},I=()=>{l.value=!l.value,h("onCornerClick",l.value)};return r.watch([()=>n.isShowReferLine],()=>{l.value=n.isShowReferLine}),o({resetMethod:R,zoomInMethod:O,zoomOutMethod:P}),(s,E)=>(r.openBlock(),r.createElementBlock("div",Qe,[r.renderSlot(s.$slots,"btn",{resetMethod:R,zoomInMethod:O,zoomOutMethod:P}),r.createElementVNode("div",{class:"canvasedit-parent",style:r.normalizeStyle(N.value),onWheel:E[0]||(E[0]=r.withModifiers(()=>{},["prevent"]))},[r.createElementVNode("div",qe,[r.renderSlot(s.$slots,"default")])],36),r.createVNode(ue,{vertical:!1,width:s.width,height:s.thick,"is-show-refer-line":l.value,thick:s.thick,ratio:s.ratio,start:f.value,lines:s.lines.h,"select-start":s.shadow.x,"select-length":s.shadow.width,scale:C.value,palette:g.value,startNumX:s.startNumX,endNumX:s.endNumX},null,8,["width","height","is-show-refer-line","thick","ratio","start","lines","select-start","select-length","scale","palette","startNumX","endNumX"]),r.createVNode(ue,{vertical:!0,width:s.thick,height:s.height,"is-show-refer-line":l.value,thick:s.thick,ratio:s.ratio,start:w.value,lines:s.lines.v,"select-start":s.shadow.y,"select-length":s.shadow.height,scale:C.value,palette:g.value,startNumY:s.startNumY,endNumY:s.endNumY},null,8,["width","height","is-show-refer-line","thick","ratio","start","lines","select-start","select-length","scale","palette","startNumY","endNumY"]),r.createElementVNode("a",{class:"corner",style:r.normalizeStyle(B.value),onClick:I},null,4)]))}});exports.SketchRule=we;exports.default=we;
