"use strict";/*!vue3-sketch-ruler v2.0.1-beta.22024年7月Thu Jul 11 2024 17:16:21 GMT+0800 (中国标准时间)制作*/Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const r=require("vue"),be={key:0,class:"value"},Ae=r.defineComponent({__name:"ruler-line",props:{scale:{},thick:{},palette:{},index:{},start:{},vertical:{type:Boolean},value:{},isShowReferLine:{type:Boolean}},emits:["onMouseDown","onRelease","onRemove"],setup(e,{emit:o}){const t=r.ref(0),n=e,h=o,c=r.ref(n.value),m=r.computed(()=>c.value>=n.start),w=r.computed(()=>{const g=(c.value-n.start)*n.scale;return n.vertical?{top:`${g}px`}:{left:`${g}px`}}),d=r.computed(()=>{var B;const g=((B=n.palette)==null?void 0:B.lineColor)??"black";return{cursor:n.isShowReferLine?n.vertical?"ns-resize":"ew-resize":"default",...n.vertical?{borderTop:`1px solid ${g}`}:{borderLeft:`1px solid ${g}`}}}),C=r.computed(()=>({backgroundColor:n.palette.hoverBg,color:n.palette.hoverColor,[n.vertical?"top":"left"]:"-8px",[n.vertical?"left":"top"]:`${t.value+10}px`}));r.onMounted(()=>{c.value=n.value??0});function k(g){const B=n.vertical?g.clientY:g.clientX,M=c.value,x=z=>{const R=((n.vertical?z.clientY:z.clientX)-B)/n.scale;c.value=Math.round(M+R),h("onMouseDown")};document.addEventListener("mousemove",x),document.addEventListener("mouseup",()=>{m.value||i(),document.removeEventListener("mousemove",x),h("onRelease",c.value,n.index)},{once:!0})}function i(){console.log("删除",n.index),h("onRemove",n.index)}const y=r.ref(!1),f=g=>{t.value=n.vertical?g.offsetX:g.offsetY},b=r.computed(()=>`${n.vertical?"Y":"X"}：${c.value}`);return(g,B)=>r.withDirectives((r.openBlock(),r.createElementBlock("div",{class:"line",style:r.normalizeStyle({...w.value,...d.value}),onMouseenter:B[0]||(B[0]=M=>y.value=!0),onMousemove:f,onMouseleave:B[1]||(B[1]=M=>y.value=!1),onMousedown:k},[r.createElementVNode("div",{class:"action",style:r.normalizeStyle(C.value)},[y.value?(r.openBlock(),r.createElementBlock("span",be,r.toDisplayString(b.value),1)):r.createCommentVNode("",!0)],4)],36)),[[r.vShow,m.value]])}}),me=(e,o)=>{const t=e.__vccOpts||e;for(const[n,h]of o)t[n]=h;return t},Se=me(Ae,[["__scopeId","data-v-8b266f1d"]]),Ne=e=>e<=.25?40:e<=.5?20:e<=1?10:e<=2?5:e<=4?2:1,ce=.83,Ce=(e,o,t,n,h,c)=>{const{scale:m,width:w,height:d,ratio:C,palette:k}=h,{bgColor:i,fontColor:y,shadowColor:f,longfgColor:b}=k,g=c?h.endNumX:h.endNumY;if(e.scale(C,C),e.clearRect(0,0,w,d),e.fillStyle=i,e.fillRect(0,0,w,d),n){const R=(t-o)*m,u=n*m;e.fillStyle=f,c?e.fillRect(R,0,u,d*3/8):e.fillRect(0,R,w*3/8,u)}const M=Ne(m)*10,x=M*m,z=-o/M*x,I=o+Math.ceil((c?w:d)/m);e.beginPath(),e.fillStyle=y,e.strokeStyle=b;for(let R=0,u=0;R<I;R+=M,u++){if(R<=g){debugger;const A=z+u*x;R==0||R==g?c?e.moveTo(A,0):e.moveTo(0,A):c?e.moveTo(A,20):e.moveTo(20,A),e.save(),R==0?c?e.translate(A-15,d*.3):e.translate(w*.3,A-5):R==g?c?e.translate(A+5,d*.1):e.translate(w*.1,A+32):c?e.translate(A-12,d*.05):e.translate(w*.05,A+12),c||e.rotate(-Math.PI/2),e.scale(ce/C,ce/C),e.fillText(R.toString(),4*C,7*C),e.restore(),R==0||R==g?c?e.lineTo(A,d):e.lineTo(w,A):c?e.lineTo(A,d*10/16):e.lineTo(w*10/16,A),console.log(A,"xBBBBBBBB")}e.stroke(),e.closePath(),e.setTransform(1,0,0,1,0,0)}},Ee=r.defineComponent({__name:"index",props:{showIndicator:{type:Boolean},valueNum:{},scale:{},ratio:{},palette:{},vertical:{},start:{},width:{},height:{},selectStart:{},selectLength:{},endNumX:{},endNumY:{}},emits:["onAddLine","update:showIndicator","update:valueNum"],setup(e,{emit:o}){const t=e,n=o,h=r.reactive({canvasContext:null});let c=1;const m=r.ref(null);r.onMounted(()=>{c=window.devicePixelRatio||1,window.addEventListener("resize",w),d(),k(c)});const w=()=>{c=window.devicePixelRatio||1,k(c),i(c)},d=()=>{h.canvasContext=m.value&&m.value.getContext("2d")},C=r.computed(()=>({[t.vertical?"borderRight":"borderBottom"]:`1px solid ${t.palette.borderColor||"#eeeeef"} `}));r.onUnmounted(()=>{window.removeEventListener("resize",w)});const k=f=>{if(m.value){m.value.width=t.width*f,m.value.height=t.height*f;const b=h.canvasContext;b&&(b.font=`${12*f}px -apple-system,
                "Helvetica Neue", ".SFNSText-Regular",
                "SF UI Text", Arial, "PingFang SC", "Hiragino Sans GB",
                "Microsoft YaHei", "WenQuanYi Zen Hei", sans-serif`,b.lineWidth=1,b.textBaseline="middle")}},i=f=>{console.log("drawRuler",t.scale);const b={scale:t.scale,width:t.width,height:t.height,palette:t.palette,endNumX:t.endNumX,endNumY:t.endNumY,ratio:f};h.canvasContext&&Ce(h.canvasContext,t.start,t.selectStart,t.selectLength,b,!t.vertical)};r.watch(()=>t.start,()=>{console.log("start",t.start),i(c)}),r.watch([()=>t.width,()=>t.height],()=>{k(c),i(c)});const y=(f,b)=>{const g=t.vertical?f.offsetY:f.offsetX,B=Math.round(t.start+g/t.scale);switch(b){case"click":n("onAddLine",B);break;case"enter":n("update:valueNum",B),n("update:showIndicator",!0);break;default:n("update:valueNum",B);break}};return(f,b)=>(r.openBlock(),r.createElementBlock("canvas",{ref_key:"canvas",ref:m,class:"ruler",style:r.normalizeStyle(C.value),onClick:b[0]||(b[0]=g=>y(g,"click")),onMouseenter:b[1]||(b[1]=g=>y(g,"enter")),onMousemove:b[2]||(b[2]=g=>y(g,"move")),onMouseleave:b[3]||(b[3]=g=>f.$emit("update:showIndicator",!1))},null,36))}}),Be={scale:Number,ratio:Number,thick:Number,endNumX:Number,endNumY:Number,palette:Object,vertical:{type:Boolean,default:!0},width:{type:Number,default:200},height:{type:Number,default:200},start:{type:Number,default:0},lines:{type:Array,default:()=>[]},selectStart:{type:Number},selectLength:{type:Number},isShowReferLine:{type:Boolean}},ke={class:"lines"},Re={class:"value"},Xe=r.defineComponent({__name:"ruler-wrapper",props:Be,emits:["update:lines","on-remove-line"],setup(e,{emit:o}){const t=e,n=r.ref(!1),h=r.ref(0),c=r.computed(()=>t.vertical?"v-container":"h-container"),m=r.computed(()=>{const i={width:`calc(100% - ${t.thick}px)`,height:`${t.thick+1}px`,left:`${t.thick}px`},y={width:`${t.thick&&t.thick+1}px`,height:`calc(100% - ${t.thick}px)`,top:`${t.thick}px`};return t.vertical?y:i}),w=r.computed(()=>{var g;const i=(h.value-t.start)*t.scale;let y=t.vertical?"top":"left",f=t.vertical?"left":"top",b=t.vertical?"borderBottom":"borderLeft";return{[y]:i+"px",[f]:t.thick+"px",[b]:`1px solid ${(g=t.palette)==null?void 0:g.lineColor}`}}),d=i=>{t.lines.push(i)},C=(i,y)=>{const f=i-t.start,b=(t.vertical?t.height:t.width)/t.scale;f<0||f>b?k(y):t.lines[y]=i},k=i=>{t.lines.splice(i,1)};return(i,y)=>(r.openBlock(),r.createElementBlock("div",{class:r.normalizeClass(c.value),style:r.normalizeStyle(m.value)},[r.createVNode(Ee,{vertical:i.vertical,scale:i.scale,width:i.width,height:i.height,start:i.start,ratio:i.ratio,endNumX:i.endNumX,startNumY:i.startNumY,endNumY:i.endNumY,"select-start":i.selectStart,"select-length":i.selectLength,palette:i.palette,valueNum:h.value,"onUpdate:valueNum":y[0]||(y[0]=f=>h.value=f),showIndicator:n.value,"onUpdate:showIndicator":y[1]||(y[1]=f=>n.value=f),onOnAddLine:d},null,8,["vertical","scale","width","height","start","ratio","endNumX","startNumY","endNumY","select-start","select-length","palette","valueNum","showIndicator"]),r.withDirectives(r.createElementVNode("div",ke,[(r.openBlock(!0),r.createElementBlock(r.Fragment,null,r.renderList(i.lines,(f,b)=>(r.openBlock(),r.createBlock(Se,{key:f+b,index:b,value:f>>0,scale:i.scale,start:i.start,thick:i.thick,palette:i.palette,vertical:i.vertical,"is-show-refer-line":i.isShowReferLine,onOnRemove:k,onOnRelease:C},null,8,["index","value","scale","start","thick","palette","vertical","is-show-refer-line"]))),128))],512),[[r.vShow,i.isShowReferLine]]),r.withDirectives(r.createElementVNode("div",{class:"indicator",style:r.normalizeStyle(w.value)},[r.createElementVNode("div",Re,r.toDisplayString(h.value),1)],4),[[r.vShow,n.value]])],6))}}),ue=me(Xe,[["__scopeId","data-v-41d371f8"]]),Oe="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABUAAAAVCAYAAACpF6WWAAAAAXNSR0IArs4c6QAAAopJREFUOE/FlE9IVEEcx7+/N9ouds1Mu0QUSFZYdIgoUqQoKPBQHsKozpXE7jbTO/U8xLJvn6usBHWQ6hBFXupSkQeVbh0KJEPp0sH+eLGTsKs77xcj78m0ax0E8cHjzZv5zef3/c33xxA24KENYGJzoEEQbNNaN4Zh2OQ4znwYhr9c1/39vwrXVDo0NNS0tLR0GYB5D64BmAMwzMyvlFKz1es10Hw+f4mZ7wHYBeA9gNdENFepVOaEEM3M3OI4Thczn41gt6WUgQ3+C+r7/h0AWQD3mXnYqPA8L9nQ0HCemduIaFpKOWoAhUJhT6VSuQXgOjP3K6W8GLwKzeVyp4jonR0QBEErM48w8zFLyayUsjX+z+VyHhHdZebTSqkxM78CHRgYOKS1/ghgVErZY214RkQ7ADyRUj72ff8qgCtmXUrZGcf5vv8CwEUhxOF0Ov1pBRpla5dSdseBhUJhpznH6tIsZb1KqacW+BGArUaUXX63UuplHJTNZjuEEONSyhozfd/n6mQ1RkXZL2itz7mu+80EDA4ONi8vL/8AcM2UbikyR2BU9cSmmTU70YqKIAj2hWFo2uenlHK/BRg3Y2aeNO5GyU8S0ZbFxcUuz/NKEXAGQKPjOCcymcyX1dIi8DSAiWQyeaavr68cbSgCuBknYubnQoj+TCYzUywWE6VS6S2ADsdx2gxw1X3L7SNENMbMnwE8qK+vf5NKpRaMaeVyeW8ikfiaSqW+R7BuZr5BRMe11p2u607U9Gk8kc/ntzPzQwCmExYATDLzVBiGE0KIowAOADDf3QA+aK2VDaxRajto3K+rq+tl5nYAzQBamHmeiOYBTGmtR6ph/1Rqg9c73pz7dD1qN0TpHyNQRCUDJXrAAAAAAElFTkSuQmCC",Ye="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABUAAAAVCAYAAACpF6WWAAAAAXNSR0IArs4c6QAAAjtJREFUOE/NlD9oFEEUxn9v9ghC0hpRUogIAUmniGAT/5Q2FrETPSNRJILg7RwimI0ox85eQFCEBGIUO1PYpFM0jSConQoBEZGgGPsgl+w+2eM2bC57SopAFqYZ3v7m+977ZoQt+GQLmGxPaBiGgYiMWWvXBHZUGoZhH3BERPYC+4F+4Keq/urt7b1RLpf/ZEBVHa9Wq0HWyg3QKIoGVPU8cA7wgK/pUtXPQJ8xZk+pVBpuNBqXUoUiEvi+P56fzTpo6+SbwHNg1lo7WzTITGEKXFlZeeB53tVCpa3CK8AFa+1cBgvD8LKIXAQOJkkyICJDeYVBEJS6u7s/qeoLa+1o+l9TqXNuBLhmjDlbqVQ+5ICjInIfOBPH8W9jzGCR5YmJiRNxHM+papgqzqDvgSlr7VTernPuO3An3c9bBt74vv+yrdaKyLDv+/1Sq9UGPc97nY9EVuycU2AQOA7cAm4Dr4D5TvVxHB9rKo2iaEFVp621Ln96FEUngaOqGmSxabVqsh3a2h+x1h5qQjNrae/yE4+iaCwDJkky73neTuBZe129Xk+H+BS4l7ZqLVIZ2BhzuFKpvMsDVXXWGPMxFdAedOfcKeCRqj7MYrUhpz09PfXl5eXrectFWXXODQHpOq2qd/95o/JXr6ura3J1dXU6SZIfwKKIHAD2tVYMPBGRx77vN10UXtO85fTkmZmZHUtLSzUR2QXsBhaAL6r6DXhbrVYXi1yss59GqOgub/bN3Z7v6X/tb9Zmp/q/kN8s+lJb8oEAAAAASUVORK5CYII=",Me={eyeIcon:{type:String},closeEyeIcon:{type:String},scale:{type:Number,default:1},ratio:{type:Number},thick:{type:Number,default:16},palette:Object,startX:{type:Number},startY:{type:Number,default:0},width:{type:Number,default:200},height:{type:Number,default:200},shadow:{type:Object,default:()=>({x:0,y:0,width:0,height:0})},lines:{type:Object,default:()=>({h:[],v:[]})},isShowReferLine:{type:Boolean,default:!0},endNumX:{type:Number,default:1/0},endNumY:{type:Number,default:1/0},panzoomOption:Object};/*!simple-panzoom v1.0.22024年7月Wed Jul 10 2024 21:12:39 GMT+0800 (中国标准时间)制作*/typeof window<"u"&&(window.NodeList&&!NodeList.prototype.forEach&&(NodeList.prototype.forEach=Array.prototype.forEach),typeof window.CustomEvent!="function"&&(window.CustomEvent=function(e,o){o=o||{bubbles:!1,cancelable:!1,detail:null};var t=document.createEvent("CustomEvent");return t.initCustomEvent(e,o.bubbles,o.cancelable,o.detail),t}));function fe(e,o){let t=e.length;for(;t--;)if(e[t].pointerId===o.pointerId)return t;return-1}function le(e,o){let t;if(o.touches){t=0;for(const n of o.touches)n.pointerId=t++,le(e,n);return}t=fe(e,o),t>-1&&e.splice(t,1),e.push(o)}function ze(e,o){if(o.touches){for(;e.length;)e.pop();return}const t=fe(e,o);t>-1&&e.splice(t,1)}function de(e){e=e.slice(0);let o=e.pop(),t;for(;t=e.pop();)o={clientX:(t.clientX-o.clientX)/2+o.clientX,clientY:(t.clientY-o.clientY)/2+o.clientY};return o}function ne(e){if(e.length<2)return 0;const o=e[0],t=e[1];return Math.sqrt(Math.pow(Math.abs(t.clientX-o.clientX),2)+Math.pow(Math.abs(t.clientY-o.clientY),2))}let F={down:"mousedown",move:"mousemove",up:"mouseup mouseleave"};typeof window<"u"&&(typeof window.PointerEvent=="function"?F={down:"pointerdown",move:"pointermove",up:"pointerup pointerleave pointercancel"}:typeof window.TouchEvent=="function"&&(F={down:"touchstart",move:"touchmove",up:"touchend touchcancel"}));function re(e,o,t,n){F[e].split(" ").forEach(h=>{o.addEventListener(h,t,n)})}function ae(e,o,t){F[e].split(" ").forEach(n=>{o.removeEventListener(n,t)})}const Le=typeof document<"u"&&!!document.documentMode;let pe;function xe(){return pe||(pe=document.createElement("div").style)}const he=["webkit","moz","ms"],Q={};function ie(e){if(Q[e])return Q[e];const o=xe();if(e in o)return Q[e]=e;const t=e[0].toUpperCase()+e.slice(1);let n=he.length;for(;n--;){const h=`${he[n]}${t}`;if(h in o)return Q[e]=h}}function q(e,o){return parseFloat(o[ie(e)])||0}function G(e,o,t=window.getComputedStyle(e)){const n=o==="border"?"Width":"";return{left:q(`${o}Left${n}`,t),right:q(`${o}Right${n}`,t),top:q(`${o}Top${n}`,t),bottom:q(`${o}Bottom${n}`,t)}}function $(e,o,t){e.style[ie(o)]=t}function Pe(e,o){const t=ie("transform");$(e,"transition",`${t} ${o.duration}ms ${o.easing}`)}function Ie(e,{x:o,y:t,scale:n,isSVG:h},c){if($(e,"transform",`scale(${n}) translate(${o}px, ${t}px)`),h&&Le){const m=window.getComputedStyle(e).getPropertyValue("transform");e.setAttribute("transform",m)}}function W(e){const o=e.parentNode,t=window.getComputedStyle(e),n=window.getComputedStyle(o),h=e.getBoundingClientRect(),c=o.getBoundingClientRect();return{elem:{style:t,width:h.width,height:h.height,top:h.top,bottom:h.bottom,left:h.left,right:h.right,margin:G(e,"margin",t),border:G(e,"border",t)},parent:{style:n,width:c.width,height:c.height,top:c.top,bottom:c.bottom,left:c.left,right:c.right,padding:G(o,"padding",n),border:G(o,"border",n)}}}function Ue(e){let o=e;for(;o&&o.parentNode;){if(o.parentNode===document)return!0;o=o.parentNode instanceof ShadowRoot?o.parentNode.host:o.parentNode}return!1}function Ve(e){return(e.getAttribute("class")||"").trim()}function $e(e,o){return e.nodeType===1&&` ${Ve(e)} `.indexOf(` ${o} `)>-1}function Te(e,o){for(let t=e;t!=null;t=t.parentNode)if($e(t,o.excludeClass)||o.exclude.indexOf(t)>-1)return!0;return!1}const De=/^http:[\w\.\/]+svg$/;function Fe(e){return De.test(e.namespaceURI)&&e.nodeName.toLowerCase()!=="svg"}function Ke(e){const o={};for(const t in e)e.hasOwnProperty(t)&&(o[t]=e[t]);return o}const ve={animate:!1,canvas:!1,cursor:"move",disablePan:!1,disableZoom:!1,disableXAxis:!1,disableYAxis:!1,duration:200,easing:"ease-in-out",exclude:[],excludeClass:"panzoom-exclude",handleStartEvent:e=>{e.preventDefault(),e.stopPropagation()},maxScale:4,minScale:.125,overflow:"hidden",panOnlyWhenZoomed:!1,pinchAndPan:!1,relative:!1,setTransform:Ie,startX:0,startY:0,startScale:1,step:.3,touchAction:"none"};function ge(e,o){if(!e)throw new Error("Panzoom requires an element as an argument");if(e.nodeType!==1)throw new Error("Panzoom requires an element with a nodeType of 1");if(!Ue(e))throw new Error("Panzoom should be called on elements that have been attached to the DOM");o={...ve,...o};const t=Fe(e),n=e.parentNode;n.style.overflow=o.overflow,n.style.userSelect="none",n.style.touchAction=o.touchAction,(o.canvas?n:e).style.cursor=o.cursor,e.style.userSelect="none",e.style.touchAction=o.touchAction,$(e,"transformOrigin",typeof o.origin=="string"?o.origin:t?"0 0":"50% 50%");function h(){n.style.overflow="",n.style.userSelect="",n.style.touchAction="",n.style.cursor="",e.style.cursor="",e.style.userSelect="",e.style.touchAction="",$(e,"transformOrigin","")}function c(a={}){for(const s in a)a.hasOwnProperty(s)&&(o[s]=a[s]);(a.hasOwnProperty("cursor")||a.hasOwnProperty("canvas"))&&(n.style.cursor=e.style.cursor="",(o.canvas?n:e).style.cursor=o.cursor),a.hasOwnProperty("overflow")&&(n.style.overflow=a.overflow),a.hasOwnProperty("touchAction")&&(n.style.touchAction=a.touchAction,e.style.touchAction=a.touchAction)}let m=0,w=0,d=1,C=!1;g(o.startScale,{animate:!1,force:!0}),setTimeout(()=>{b(o.startX,o.startY,{animate:!1,force:!0})});function k(a,s,v){if(v.silent)return;const N=new CustomEvent(a,{detail:s});e.dispatchEvent(N)}function i(a,s,v){const N={x:m,y:w,scale:d,isSVG:t,originalEvent:v};typeof s.animate=="boolean"&&(s.animate?Pe(e,s):$(e,"transition","none")),s.setTransform(e,N,s);function l(){const S=W(e);N.dimsOut=S,k(a,N,s),k("panzoomchange",N,s)}return s.animate?setTimeout(()=>{l()},s.duration+50):requestAnimationFrame(()=>{l()}),N}function y(a,s,v,N){const l={...o,...N},S={x:m,y:w,opts:l};if(!l.force&&(l.disablePan||l.panOnlyWhenZoomed&&d===l.startScale))return S;if(a=parseFloat(a),s=parseFloat(s),l.disableXAxis||(S.x=(l.relative?m:0)+a),l.disableYAxis||(S.y=(l.relative?w:0)+s),l.contain){const p=W(e),L=p.elem.width/d,Y=p.elem.height/d,T=L*v,D=Y*v,U=(T-L)/2,V=(D-Y)/2;if(l.contain==="inside"){const _=(-p.elem.margin.left-p.parent.padding.left+U)/v,ee=(p.parent.width-T-p.parent.padding.left-p.elem.margin.left-p.parent.border.left-p.parent.border.right+U)/v;S.x=Math.max(Math.min(S.x,ee),_);const te=(-p.elem.margin.top-p.parent.padding.top+V)/v,oe=(p.parent.height-D-p.parent.padding.top-p.elem.margin.top-p.parent.border.top-p.parent.border.bottom+V)/v;S.y=Math.max(Math.min(S.y,oe),te)}else if(l.contain==="outside"){const _=(-(T-p.parent.width)-p.parent.padding.left-p.parent.border.left-p.parent.border.right+U)/v,ee=(U-p.parent.padding.left)/v;S.x=Math.max(Math.min(S.x,ee),_);const te=(-(D-p.parent.height)-p.parent.padding.top-p.parent.border.top-p.parent.border.bottom+V)/v,oe=(V-p.parent.padding.top)/v;S.y=Math.max(Math.min(S.y,oe),te)}}return l.roundPixels&&(S.x=Math.round(S.x),S.y=Math.round(S.y)),S}function f(a,s){const v={...o,...s},N={scale:d,opts:v};if(!v.force&&v.disableZoom)return N;let l=o.minScale,S=o.maxScale;if(v.contain){const p=W(e),L=p.elem.width/d,Y=p.elem.height/d;if(L>1&&Y>1){const T=p.parent.width-p.parent.border.left-p.parent.border.right,D=p.parent.height-p.parent.border.top-p.parent.border.bottom,U=T/L,V=D/Y;o.contain==="inside"?S=Math.min(S,U,V):o.contain==="outside"&&(l=Math.max(l,U,V))}}return N.scale=Math.min(Math.max(a,l),S),N}function b(a,s,v,N){const l=y(a,s,d,v);return m!==l.x||w!==l.y?(m=l.x,w=l.y,i("panzoompan",l.opts,N)):{x:m,y:w,scale:d,isSVG:t,originalEvent:N}}function g(a,s,v){const N=f(a,s),l=N.opts;if(!l.force&&l.disableZoom)return;a=N.scale;let S=m,p=w;if(l.focal){const Y=l.focal;S=(Y.x/a-Y.x/d+m*a)/a,p=(Y.y/a-Y.y/d+w*a)/a}const L=y(S,p,a,{relative:!1,force:!0});return m=L.x,w=L.y,d=a,i("panzoomzoom",l,v)}function B(a,s){const v={...o,animate:!0,...s};return g(d*Math.exp((a?1:-1)*v.step),v)}function M(a){return B(!0,a)}function x(a){return B(!1,a)}function z(a,s,v,N){const l=W(e),S={width:l.parent.width-l.parent.padding.left-l.parent.padding.right-l.parent.border.left-l.parent.border.right,height:l.parent.height-l.parent.padding.top-l.parent.padding.bottom-l.parent.border.top-l.parent.border.bottom};let p=s.clientX-l.parent.left-l.parent.padding.left-l.parent.border.left-l.elem.margin.left,L=s.clientY-l.parent.top-l.parent.padding.top-l.parent.border.top-l.elem.margin.top;t||(p-=l.elem.width/d/2,L-=l.elem.height/d/2);const Y={x:p/S.width*(S.width*a),y:L/S.height*(S.height*a)};return g(a,{...v,animate:!1,focal:Y},N)}function I(a,s){a.preventDefault();const v={...o,...s,animate:!1},N=(a.deltaY===0&&a.deltaX?a.deltaX:a.deltaY)<0?1:-1,l=f(d*Math.exp(N*v.step/3),v).scale;return z(l,a,v,a)}function R(a){const s={...o,animate:!0,force:!0,...a};d=f(s.startScale,s).scale;const v=y(s.startX,s.startY,d,s);return m=v.x,w=v.y,i("panzoomreset",s)}let u,A,E,O,X,K;const P=[];function Z(a){if(Te(a.target,o))return;le(P,a),C=!0,o.handleStartEvent(a),u=m,A=w,k("panzoomstart",{x:m,y:w,scale:d,isSVG:t,originalEvent:a},o);const s=de(P);E=s.clientX,O=s.clientY,X=d,K=ne(P)}function j(a){if(!C||u===void 0||A===void 0||E===void 0||O===void 0)return;le(P,a);const s=de(P),v=P.length>1;let N=d;if(v){K===0&&(K=ne(P));const l=ne(P)-K;N=f(l*o.step/80+X).scale,z(N,s,{animate:!1},a)}(!v||o.pinchAndPan)&&b(u+(s.clientX-E)/N,A+(s.clientY-O)/N,{animate:!1},a)}function H(a){P.length===1&&k("panzoomend",{x:m,y:w,scale:d,isSVG:t,originalEvent:a},o),ze(P,a),C&&(C=!1,u=A=E=O=void 0)}let J=!1;function se(){J||(J=!0,re("down",o.canvas?n:e,Z),re("move",document,j,{passive:!0}),re("up",document,H,{passive:!0}))}function ye(){J=!1,ae("down",o.canvas?n:e,Z),ae("move",document,j),ae("up",document,H)}return o.noBind||se(),{bind:se,destroy:ye,eventNames:F,getPan:()=>({x:m,y:w}),getScale:()=>d,getOptions:()=>Ke(o),handleDown:Z,handleMove:j,handleUp:H,pan:b,reset:R,resetStyle:h,setOptions:c,setStyle:(a,s)=>$(e,a,s),zoom:g,zoomIn:M,zoomOut:x,zoomToPoint:z,zoomWithWheel:I}}ge.defaultOptions=ve;const Qe={class:"sketch-ruler"},qe={class:"canvasedit"},we=r.defineComponent({__name:"index",props:Me,emits:["onCornerClick","update:scale"],setup(e,{expose:o,emit:t}){const n=e,h=t,c=r.ref(null),m=r.ref(0),w=r.ref(0),d=r.ref(0),C=r.ref(0),k=r.ref(1),i=r.ref(n.isShowReferLine),y=r.ref(null),f=r.computed(()=>{function u(E,O){return Object.keys(E).forEach(X=>{X&&E.hasOwnProperty(X)&&(typeof O[X]=="object"?E[X]=u(E[X],O[X]):O.hasOwnProperty(X)&&(E[X]=O[X]))}),E}return u({bgColor:"#f6f7f9",longfgColor:"#BABBBC",fontColor:"#7D8694",shadowColor:"#E8E8E8",lineColor:"#EB5648",hoverBg:"#000",hoverColor:"#fff",borderColor:"#eeeeef",cornerActiveColor:"rgb(235, 86, 72, 0.6)",menu:{bgColor:"#fff",dividerColor:"#DBDBDB",listItem:{textColor:"#415058",hoverTextColor:"#298DF8",disabledTextColor:"rgba(65, 80, 88, 0.4)",bgColor:"#fff",hoverBgColor:"#F2F2F2"}}},n.palette||{})}),b=r.computed(()=>({backgroundImage:i.value?`url(${n.eyeIcon||Oe})`:`url(${n.closeEyeIcon||Ye})`,width:n.thick+"px",height:n.thick+"px",borderRight:`1px solid ${f.value.borderColor}`,borderBottom:`1px solid ${f.value.borderColor}`})),g=r.computed(()=>({backgroundColor:f.value.bgColor,backgroundImage:f.value.backgroundImage,width:n.width+"px",height:n.height+"px"}));r.onMounted(()=>{B()});const B=()=>{c.value=document.querySelector(".canvasedit"),M(),y.value=ge(c.value,{noBind:!0,startScale:n.scale,cursor:"default",startX:d.value,startY:C.value,smoothScroll:!0,...n.panzoomOption}),c.value.addEventListener("panzoomchange",u=>{const{scale:A,dimsOut:E}=u.detail;if(E){console.log(u.detail,"event.detail"),h("update:scale",A),k.value=A;const O=(E.parent.left-E.elem.left)/A,X=(E.parent.top-E.elem.top)/A;m.value=O,console.log(m.value*A,"startX.value"),console.log(A,"scale"),w.value=X}}),parent.addEventListener("wheel",function(u){(u.ctrlKey||u.metaKey)&&y.value.zoomWithWheel(u)}),parent.addEventListener("keydown",function(u){u.key===" "&&y.value.bind()}),parent.addEventListener("keyup",function(u){u.key===" "&&y.value.destroy()})},M=()=>{const A=document.querySelector(".canvasedit-parent").getBoundingClientRect(),E=c.value.children[0].getBoundingClientRect(),{width:O,height:X}=A;O>E.width?(d.value=(O-n.thick-E.width)/2,X>E.height?C.value=(X-n.thick-E.height)/2:C.value=0):(C.value=0,d.value=0)},x=()=>{y.value.reset()},z=()=>{y.value.zoomIn()},I=()=>{y.value.zoomOut()},R=()=>{i.value=!i.value,h("onCornerClick",i.value)};return r.watch([()=>n.isShowReferLine],()=>{i.value=n.isShowReferLine}),o({initPanzoom:B,panzoomInstance:y,reset:x,zoomIn:z,zoomOut:I}),(u,A)=>(r.openBlock(),r.createElementBlock("div",Qe,[r.renderSlot(u.$slots,"btn",{reset:x,zoomIn:z,zoomOut:I}),r.createElementVNode("div",{class:"canvasedit-parent",style:r.normalizeStyle(g.value),onWheel:A[0]||(A[0]=r.withModifiers(()=>{},["prevent"]))},[r.createElementVNode("div",qe,[r.renderSlot(u.$slots,"default")])],36),r.createVNode(ue,{vertical:!1,width:u.width,height:u.thick,"is-show-refer-line":i.value,thick:u.thick,ratio:u.ratio,start:m.value,lines:u.lines.h,"select-start":u.shadow.x,"select-length":u.shadow.width,scale:k.value,palette:f.value,endNumX:u.endNumX},null,8,["width","height","is-show-refer-line","thick","ratio","start","lines","select-start","select-length","scale","palette","endNumX"]),r.createVNode(ue,{vertical:!0,width:u.thick,height:u.height,"is-show-refer-line":i.value,thick:u.thick,ratio:u.ratio,start:w.value,lines:u.lines.v,"select-start":u.shadow.y,"select-length":u.shadow.height,scale:k.value,palette:f.value,endNumY:u.endNumY},null,8,["width","height","is-show-refer-line","thick","ratio","start","lines","select-start","select-length","scale","palette","endNumY"]),r.createElementVNode("a",{class:"corner",style:r.normalizeStyle(b.value),onClick:R},null,4)]))}});exports.SketchRule=we;exports.default=we;
