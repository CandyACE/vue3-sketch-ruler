"use strict";/*!vue3-sketch-ruler v2.0.1-beta.02024年7月Wed Jul 10 2024 13:56:14 GMT+0800 (中国标准时间)制作*/Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const r=require("vue"),be={key:0,class:"value"},Ae=r.defineComponent({__name:"ruler-line",props:{scale:{},thick:{},palette:{},index:{},start:{},vertical:{type:Boolean},value:{},isShowReferLine:{type:Boolean}},emits:["onMouseDown","onRelease","onRemove"],setup(e,{emit:t}){const o=r.ref(0),n=e,f=t,d=r.ref(n.value),v=r.computed(()=>d.value>=n.start),w=r.computed(()=>{const A=(d.value-n.start)*n.scale;return n.vertical?{top:`${A}px`}:{left:`${A}px`}}),p=r.computed(()=>{var k;const A=((k=n.palette)==null?void 0:k.lineColor)??"black";return{cursor:n.isShowReferLine?n.vertical?"ns-resize":"ew-resize":"default",...n.vertical?{borderTop:`1px solid ${A}`}:{borderLeft:`1px solid ${A}`}}}),S=r.computed(()=>({[n.vertical?"left":"top"]:`${o.value}px`}));r.onMounted(()=>{d.value=n.value??0});function B(A){const k=n.vertical?A.clientY:A.clientX,O=d.value,M=Y=>{const z=((n.vertical?Y.clientY:Y.clientX)-k)/n.scale;d.value=Math.round(O+z),f("onMouseDown")};document.addEventListener("mousemove",M),document.addEventListener("mouseup",()=>{v.value||i(),document.removeEventListener("mousemove",M),f("onRelease",d.value,n.index)},{once:!0})}function i(){console.log("删除",n.index),f("onRemove",n.index)}const h=r.ref(!1),u=A=>{o.value=n.vertical?A.offsetX:A.offsetY},N=r.computed(()=>`${n.vertical?"Y":"X"}：${d.value}`);return(A,k)=>r.withDirectives((r.openBlock(),r.createElementBlock("div",{class:"line",style:r.normalizeStyle({...w.value,...p.value}),onMouseenter:k[0]||(k[0]=O=>h.value=!0),onMousemove:u,onMouseleave:k[1]||(k[1]=O=>h.value=!1),onMousedown:B},[r.createElementVNode("div",{class:"action",style:r.normalizeStyle(S.value)},[h.value?(r.openBlock(),r.createElementBlock("span",be,r.toDisplayString(N.value),1)):r.createCommentVNode("",!0)],4)],36)),[[r.vShow,v.value]])}}),me=(e,t)=>{const o=e.__vccOpts||e;for(const[n,f]of t)o[n]=f;return o},Se=me(Ae,[["__scopeId","data-v-aebb098c"]]),Ne=e=>e<=.25?40:e<=.5?20:e<=1?10:e<=2?5:e<=4?2:1,ce=.83,Ee=(e,t,o,n,f,d)=>{const{scale:v,width:w,height:p,ratio:S,palette:B}=f,{bgColor:i,fontColor:h,shadowColor:u,longfgColor:N}=B,A=d?f.endNumX:f.endNumY;if(e.scale(S,S),e.clearRect(0,0,w,p),e.fillStyle=i,e.fillRect(0,0,w,p),n){const z=(o-t)*v,c=n*v;e.fillStyle=u,d?e.fillRect(z,0,c,p*3/8):e.fillRect(0,z,w*3/8,c)}const O=Ne(v)*10,M=O*v,Y=-t/O*M,U=t+Math.ceil((d?w:p)/v);e.beginPath(),e.fillStyle=h,e.strokeStyle=N;for(let z=0,c=0;z<U;z+=O,c++){if(z<=A){debugger;const E=Y+c*M;d?e.moveTo(E,0):e.moveTo(0,E),e.save(),d?e.translate(E,p*.4):e.translate(w*.4,E),d||e.rotate(-Math.PI/2),e.scale(ce/S,ce/S),e.fillText(z.toString(),4*S,7*S),e.restore(),d?e.lineTo(E,p*9/16):e.lineTo(w*9/16,E),console.log(E,"xBBBBBBBB")}e.stroke(),e.closePath(),e.setTransform(1,0,0,1,0,0)}},Ce=r.defineComponent({__name:"index",props:{showIndicator:{type:Boolean},valueNum:{},scale:{},ratio:{},palette:{},vertical:{},start:{},width:{},height:{},selectStart:{},selectLength:{},endNumX:{},endNumY:{}},emits:["onAddLine","update:showIndicator","update:valueNum"],setup(e,{emit:t}){const o=e,n=t,f=r.reactive({canvasContext:null});let d=1;const v=r.ref(null);r.onMounted(()=>{d=window.devicePixelRatio||1,window.addEventListener("resize",w),p(),S(d)});const w=()=>{d=window.devicePixelRatio||1,S(d),B(d)},p=()=>{f.canvasContext=v.value&&v.value.getContext("2d")};r.onUnmounted(()=>{window.removeEventListener("resize",w)});const S=h=>{if(v.value){v.value.width=o.width*h,v.value.height=o.height*h;const u=f.canvasContext;u&&(u.font=`${12*h}px -apple-system,
                "Helvetica Neue", ".SFNSText-Regular",
                "SF UI Text", Arial, "PingFang SC", "Hiragino Sans GB",
                "Microsoft YaHei", "WenQuanYi Zen Hei", sans-serif`,u.lineWidth=1,u.textBaseline="middle")}},B=h=>{console.log("drawRuler",o.scale);const u={scale:o.scale,width:o.width,height:o.height,palette:o.palette,endNumX:o.endNumX,endNumY:o.endNumY,ratio:h};f.canvasContext&&Ee(f.canvasContext,o.start,o.selectStart,o.selectLength,u,!o.vertical)};r.watch(()=>o.start,()=>{console.log("start",o.start),B(d)}),r.watch([()=>o.width,()=>o.height],()=>{S(d),B(d)});const i=(h,u)=>{const N=(O,M,Y)=>Math.round(M+O/Y),A=o.vertical?h.offsetY:h.offsetX,k=N(A,o.start,o.scale);switch(u){case"click":n("onAddLine",k);break;case"enter":n("update:valueNum",k),n("update:showIndicator",!0);break;default:n("update:valueNum",k);break}};return(h,u)=>(r.openBlock(),r.createElementBlock("canvas",{ref_key:"canvas",ref:v,class:"ruler",onClick:u[0]||(u[0]=N=>i(N,"click")),onMouseenter:u[1]||(u[1]=N=>i(N,"enter")),onMousemove:u[2]||(u[2]=N=>i(N,"move")),onMouseleave:u[3]||(u[3]=N=>h.$emit("update:showIndicator",!1))},null,544))}}),Be={scale:Number,ratio:Number,thick:Number,endNumX:Number,endNumY:Number,palette:Object,vertical:{type:Boolean,default:!0},width:{type:Number,default:200},height:{type:Number,default:200},start:{type:Number,default:0},lines:{type:Array,default:()=>[]},selectStart:{type:Number},selectLength:{type:Number},isShowReferLine:{type:Boolean}},ke={class:"lines"},Re={class:"value"},Xe=r.defineComponent({__name:"ruler-wrapper",props:Be,emits:["update:lines","on-remove-line"],setup(e,{emit:t}){const o=e,n=r.ref(!1),f=r.ref(0),d=r.computed(()=>o.vertical?"v-container":"h-container"),v=r.computed(()=>{const i={width:`calc(100% - ${o.thick}px)`,height:`${o.thick+1}px`,left:`${o.thick}px`},h={width:`${o.thick&&o.thick+1}px`,height:`calc(100% - ${o.thick}px)`,top:`${o.thick}px`};return o.vertical?h:i}),w=r.computed(()=>{var A;const i=(f.value-o.start)*o.scale;let h=o.vertical?"top":"left",u=o.vertical?"left":"top",N=o.vertical?"borderBottom":"borderLeft";return{[h]:i+"px",[u]:o.thick+"px",[N]:`1px solid ${(A=o.palette)==null?void 0:A.lineColor}`}}),p=i=>{o.lines.push(i)},S=(i,h)=>{const u=i-o.start,N=(o.vertical?o.height:o.width)/o.scale;u<0||u>N?B(h):o.lines[h]=i},B=i=>{o.lines.splice(i,1)};return(i,h)=>(r.openBlock(),r.createElementBlock("div",{class:r.normalizeClass(d.value),style:r.normalizeStyle(v.value)},[r.createVNode(Ce,{vertical:i.vertical,scale:i.scale,width:i.width,height:i.height,start:i.start,ratio:i.ratio,endNumX:i.endNumX,startNumY:i.startNumY,endNumY:i.endNumY,"select-start":i.selectStart,"select-length":i.selectLength,palette:i.palette,valueNum:f.value,"onUpdate:valueNum":h[0]||(h[0]=u=>f.value=u),showIndicator:n.value,"onUpdate:showIndicator":h[1]||(h[1]=u=>n.value=u),onOnAddLine:p},null,8,["vertical","scale","width","height","start","ratio","endNumX","startNumY","endNumY","select-start","select-length","palette","valueNum","showIndicator"]),r.withDirectives(r.createElementVNode("div",ke,[(r.openBlock(!0),r.createElementBlock(r.Fragment,null,r.renderList(i.lines,(u,N)=>(r.openBlock(),r.createBlock(Se,{key:u+N,index:N,value:u>>0,scale:i.scale,start:i.start,thick:i.thick,palette:i.palette,vertical:i.vertical,"is-show-refer-line":i.isShowReferLine,onOnRemove:B,onOnRelease:S},null,8,["index","value","scale","start","thick","palette","vertical","is-show-refer-line"]))),128))],512),[[r.vShow,i.isShowReferLine]]),r.withDirectives(r.createElementVNode("div",{class:"indicator",style:r.normalizeStyle(w.value)},[r.createElementVNode("div",Re,r.toDisplayString(f.value),1)],4),[[r.vShow,n.value]])],6))}}),ue=me(Xe,[["__scopeId","data-v-41d371f8"]]),Oe="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABUAAAAVCAYAAACpF6WWAAAAAXNSR0IArs4c6QAAAopJREFUOE/FlE9IVEEcx7+/N9ouds1Mu0QUSFZYdIgoUqQoKPBQHsKozpXE7jbTO/U8xLJvn6usBHWQ6hBFXupSkQeVbh0KJEPp0sH+eLGTsKs77xcj78m0ax0E8cHjzZv5zef3/c33xxA24KENYGJzoEEQbNNaN4Zh2OQ4znwYhr9c1/39vwrXVDo0NNS0tLR0GYB5D64BmAMwzMyvlFKz1es10Hw+f4mZ7wHYBeA9gNdENFepVOaEEM3M3OI4Thczn41gt6WUgQ3+C+r7/h0AWQD3mXnYqPA8L9nQ0HCemduIaFpKOWoAhUJhT6VSuQXgOjP3K6W8GLwKzeVyp4jonR0QBEErM48w8zFLyayUsjX+z+VyHhHdZebTSqkxM78CHRgYOKS1/ghgVErZY214RkQ7ADyRUj72ff8qgCtmXUrZGcf5vv8CwEUhxOF0Ov1pBRpla5dSdseBhUJhpznH6tIsZb1KqacW+BGArUaUXX63UuplHJTNZjuEEONSyhozfd/n6mQ1RkXZL2itz7mu+80EDA4ONi8vL/8AcM2UbikyR2BU9cSmmTU70YqKIAj2hWFo2uenlHK/BRg3Y2aeNO5GyU8S0ZbFxcUuz/NKEXAGQKPjOCcymcyX1dIi8DSAiWQyeaavr68cbSgCuBknYubnQoj+TCYzUywWE6VS6S2ADsdx2gxw1X3L7SNENMbMnwE8qK+vf5NKpRaMaeVyeW8ikfiaSqW+R7BuZr5BRMe11p2u607U9Gk8kc/ntzPzQwCmExYATDLzVBiGE0KIowAOADDf3QA+aK2VDaxRajto3K+rq+tl5nYAzQBamHmeiOYBTGmtR6ph/1Rqg9c73pz7dD1qN0TpHyNQRCUDJXrAAAAAAElFTkSuQmCC",Ye="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABUAAAAVCAYAAACpF6WWAAAAAXNSR0IArs4c6QAAAjtJREFUOE/NlD9oFEEUxn9v9ghC0hpRUogIAUmniGAT/5Q2FrETPSNRJILg7RwimI0ox85eQFCEBGIUO1PYpFM0jSConQoBEZGgGPsgl+w+2eM2bC57SopAFqYZ3v7m+977ZoQt+GQLmGxPaBiGgYiMWWvXBHZUGoZhH3BERPYC+4F+4Keq/urt7b1RLpf/ZEBVHa9Wq0HWyg3QKIoGVPU8cA7wgK/pUtXPQJ8xZk+pVBpuNBqXUoUiEvi+P56fzTpo6+SbwHNg1lo7WzTITGEKXFlZeeB53tVCpa3CK8AFa+1cBgvD8LKIXAQOJkkyICJDeYVBEJS6u7s/qeoLa+1o+l9TqXNuBLhmjDlbqVQ+5ICjInIfOBPH8W9jzGCR5YmJiRNxHM+papgqzqDvgSlr7VTernPuO3An3c9bBt74vv+yrdaKyLDv+/1Sq9UGPc97nY9EVuycU2AQOA7cAm4Dr4D5TvVxHB9rKo2iaEFVp621Ln96FEUngaOqGmSxabVqsh3a2h+x1h5qQjNrae/yE4+iaCwDJkky73neTuBZe129Xk+H+BS4l7ZqLVIZ2BhzuFKpvMsDVXXWGPMxFdAedOfcKeCRqj7MYrUhpz09PfXl5eXrectFWXXODQHpOq2qd/95o/JXr6ura3J1dXU6SZIfwKKIHAD2tVYMPBGRx77vN10UXtO85fTkmZmZHUtLSzUR2QXsBhaAL6r6DXhbrVYXi1yss59GqOgub/bN3Z7v6X/tb9Zmp/q/kN8s+lJb8oEAAAAASUVORK5CYII=",ze={eyeIcon:{type:String},closeEyeIcon:{type:String},scale:{type:Number,default:1},ratio:{type:Number},thick:{type:Number,default:16},palette:Object,startX:{type:Number},startY:{type:Number,default:0},width:{type:Number,default:200},height:{type:Number,default:200},shadow:{type:Object,default:()=>({x:0,y:0,width:0,height:0})},lines:{type:Object,default:()=>({h:[],v:[]})},isShowReferLine:{type:Boolean,default:!0},endNumX:{type:Number,default:1/0},endNumY:{type:Number,default:1/0},panzoomOption:Object};/*!simple-panzoom v1.0.12024年7月Sat Jul 06 2024 11:41:16 GMT+0800 (中国标准时间)制作*/typeof window<"u"&&(window.NodeList&&!NodeList.prototype.forEach&&(NodeList.prototype.forEach=Array.prototype.forEach),typeof window.CustomEvent!="function"&&(window.CustomEvent=function(e,t){t=t||{bubbles:!1,cancelable:!1,detail:null};var o=document.createEvent("CustomEvent");return o.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),o}));function fe(e,t){let o=e.length;for(;o--;)if(e[o].pointerId===t.pointerId)return o;return-1}function le(e,t){let o;if(t.touches){o=0;for(const n of t.touches)n.pointerId=o++,le(e,n);return}o=fe(e,t),o>-1&&e.splice(o,1),e.push(t)}function Me(e,t){if(t.touches){for(;e.length;)e.pop();return}const o=fe(e,t);o>-1&&e.splice(o,1)}function de(e){e=e.slice(0);let t=e.pop(),o;for(;o=e.pop();)t={clientX:(o.clientX-t.clientX)/2+t.clientX,clientY:(o.clientY-t.clientY)/2+t.clientY};return t}function ne(e){if(e.length<2)return 0;const t=e[0],o=e[1];return Math.sqrt(Math.pow(Math.abs(o.clientX-t.clientX),2)+Math.pow(Math.abs(o.clientY-t.clientY),2))}let F={down:"mousedown",move:"mousemove",up:"mouseup mouseleave"};typeof window<"u"&&(typeof window.PointerEvent=="function"?F={down:"pointerdown",move:"pointermove",up:"pointerup pointerleave pointercancel"}:typeof window.TouchEvent=="function"&&(F={down:"touchstart",move:"touchmove",up:"touchend touchcancel"}));function re(e,t,o,n){F[e].split(" ").forEach(f=>{t.addEventListener(f,o,n)})}function ae(e,t,o){F[e].split(" ").forEach(n=>{t.removeEventListener(n,o)})}const xe=typeof document<"u"&&!!document.documentMode;let pe;function Le(){return pe||(pe=document.createElement("div").style)}const he=["webkit","moz","ms"],Q={};function ie(e){if(Q[e])return Q[e];const t=Le();if(e in t)return Q[e]=e;const o=e[0].toUpperCase()+e.slice(1);let n=he.length;for(;n--;){const f=`${he[n]}${o}`;if(f in t)return Q[e]=f}}function q(e,t){return parseFloat(t[ie(e)])||0}function G(e,t,o=window.getComputedStyle(e)){const n=t==="border"?"Width":"";return{left:q(`${t}Left${n}`,o),right:q(`${t}Right${n}`,o),top:q(`${t}Top${n}`,o),bottom:q(`${t}Bottom${n}`,o)}}function $(e,t,o){e.style[ie(t)]=o}function Pe(e,t){const o=ie("transform");$(e,"transition",`${o} ${t.duration}ms ${t.easing}`)}function Ue(e,{x:t,y:o,scale:n,isSVG:f},d){if($(e,"transform",`scale(${n}) translate(${t}px, ${o}px)`),f&&xe){const v=window.getComputedStyle(e).getPropertyValue("transform");e.setAttribute("transform",v)}}function W(e){const t=e.parentNode,o=window.getComputedStyle(e),n=window.getComputedStyle(t),f=e.getBoundingClientRect(),d=t.getBoundingClientRect();return{elem:{style:o,width:f.width,height:f.height,top:f.top,bottom:f.bottom,left:f.left,right:f.right,margin:G(e,"margin",o),border:G(e,"border",o)},parent:{style:n,width:d.width,height:d.height,top:d.top,bottom:d.bottom,left:d.left,right:d.right,padding:G(t,"padding",n),border:G(t,"border",n)}}}function Ie(e){let t=e;for(;t&&t.parentNode;){if(t.parentNode===document)return!0;t=t.parentNode instanceof ShadowRoot?t.parentNode.host:t.parentNode}return!1}function Ve(e){return(e.getAttribute("class")||"").trim()}function $e(e,t){return e.nodeType===1&&` ${Ve(e)} `.indexOf(` ${t} `)>-1}function De(e,t){for(let o=e;o!=null;o=o.parentNode)if($e(o,t.excludeClass)||t.exclude.indexOf(o)>-1)return!0;return!1}const Te=/^http:[\w\.\/]+svg$/;function Fe(e){return Te.test(e.namespaceURI)&&e.nodeName.toLowerCase()!=="svg"}function Ke(e){const t={};for(const o in e)e.hasOwnProperty(o)&&(t[o]=e[o]);return t}const ve={animate:!1,canvas:!1,cursor:"move",disablePan:!1,disableZoom:!1,disableXAxis:!1,disableYAxis:!1,duration:200,easing:"ease-in-out",exclude:[],excludeClass:"panzoom-exclude",handleStartEvent:e=>{e.preventDefault(),e.stopPropagation()},maxScale:4,minScale:.125,overflow:"hidden",panOnlyWhenZoomed:!1,pinchAndPan:!1,relative:!1,setTransform:Ue,startX:0,startY:0,startScale:1,step:.3,touchAction:"none"};function ge(e,t){if(!e)throw new Error("Panzoom requires an element as an argument");if(e.nodeType!==1)throw new Error("Panzoom requires an element with a nodeType of 1");if(!Ie(e))throw new Error("Panzoom should be called on elements that have been attached to the DOM");t={...ve,...t};const o=Fe(e),n=e.parentNode;n.style.overflow=t.overflow,n.style.userSelect="none",n.style.touchAction=t.touchAction,(t.canvas?n:e).style.cursor=t.cursor,e.style.userSelect="none",e.style.touchAction=t.touchAction,$(e,"transformOrigin",typeof t.origin=="string"?t.origin:o?"0 0":"50% 50%");function f(){n.style.overflow="",n.style.userSelect="",n.style.touchAction="",n.style.cursor="",e.style.cursor="",e.style.userSelect="",e.style.touchAction="",$(e,"transformOrigin","")}function d(a={}){for(const s in a)a.hasOwnProperty(s)&&(t[s]=a[s]);(a.hasOwnProperty("cursor")||a.hasOwnProperty("canvas"))&&(n.style.cursor=e.style.cursor="",(t.canvas?n:e).style.cursor=t.cursor),a.hasOwnProperty("overflow")&&(n.style.overflow=a.overflow),a.hasOwnProperty("touchAction")&&(n.style.touchAction=a.touchAction,e.style.touchAction=a.touchAction)}let v=0,w=0,p=1,S=!1;A(t.startScale,{animate:!1,force:!0}),setTimeout(()=>{N(t.startX,t.startY,{animate:!1,force:!0})});function B(a,s,g){if(g.silent)return;const b=new CustomEvent(a,{detail:s});e.dispatchEvent(b)}function i(a,s,g){const b={x:v,y:w,scale:p,isSVG:o,originalEvent:g};typeof s.animate=="boolean"&&(s.animate?Pe(e,s):$(e,"transition","none")),s.setTransform(e,b,s);function l(){const y=W(e);b.dimsOut=y,B(a,b,s),B("panzoomchange",b,s)}return s.animate?setTimeout(()=>{l()},s.duration+50):requestAnimationFrame(()=>{l()}),b}function h(a,s,g,b){const l={...t,...b},y={x:v,y:w,opts:l};if(!l.force&&(l.disablePan||l.panOnlyWhenZoomed&&p===l.startScale))return y;if(a=parseFloat(a),s=parseFloat(s),l.disableXAxis||(y.x=(l.relative?v:0)+a),l.disableYAxis||(y.y=(l.relative?w:0)+s),l.contain){const m=W(e),L=m.elem.width/p,x=m.elem.height/p,D=L*g,T=x*g,I=(D-L)/2,V=(T-x)/2;if(l.contain==="inside"){const _=(-m.elem.margin.left-m.parent.padding.left+I)/g,ee=(m.parent.width-D-m.parent.padding.left-m.elem.margin.left-m.parent.border.left-m.parent.border.right+I)/g;y.x=Math.max(Math.min(y.x,ee),_);const te=(-m.elem.margin.top-m.parent.padding.top+V)/g,oe=(m.parent.height-T-m.parent.padding.top-m.elem.margin.top-m.parent.border.top-m.parent.border.bottom+V)/g;y.y=Math.max(Math.min(y.y,oe),te)}else if(l.contain==="outside"){const _=(-(D-m.parent.width)-m.parent.padding.left-m.parent.border.left-m.parent.border.right+I)/g,ee=(I-m.parent.padding.left)/g;y.x=Math.max(Math.min(y.x,ee),_);const te=(-(T-m.parent.height)-m.parent.padding.top-m.parent.border.top-m.parent.border.bottom+V)/g,oe=(V-m.parent.padding.top)/g;y.y=Math.max(Math.min(y.y,oe),te)}}return l.roundPixels&&(y.x=Math.round(y.x),y.y=Math.round(y.y)),y}function u(a,s){const g={...t,...s},b={scale:p,opts:g};if(!g.force&&g.disableZoom)return b;let l=t.minScale,y=t.maxScale;if(g.contain){const m=W(e),L=m.elem.width/p,x=m.elem.height/p;if(L>1&&x>1){const D=m.parent.width-m.parent.border.left-m.parent.border.right,T=m.parent.height-m.parent.border.top-m.parent.border.bottom,I=D/L,V=T/x;t.contain==="inside"?y=Math.min(y,I,V):t.contain==="outside"&&(l=Math.max(l,I,V))}}return b.scale=Math.min(Math.max(a,l),y),b}function N(a,s,g,b){const l=h(a,s,p,g);return v!==l.x||w!==l.y?(v=l.x,w=l.y,i("panzoompan",l.opts,b)):{x:v,y:w,scale:p,isSVG:o,originalEvent:b}}function A(a,s,g){const b=u(a,s),l=b.opts;if(!l.force&&l.disableZoom)return;a=b.scale;let y=v,m=w;if(l.focal){const x=l.focal;y=(x.x/a-x.x/p+v*a)/a,m=(x.y/a-x.y/p+w*a)/a}const L=h(y,m,a,{relative:!1,force:!0});return v=L.x,w=L.y,p=a,i("panzoomzoom",l,g)}function k(a,s){const g={...t,animate:!0,...s};return A(p*Math.exp((a?1:-1)*g.step),g)}function O(a){return k(!0,a)}function M(a){return k(!1,a)}function Y(a,s,g,b){const l=W(e),y={width:l.parent.width-l.parent.padding.left-l.parent.padding.right-l.parent.border.left-l.parent.border.right,height:l.parent.height-l.parent.padding.top-l.parent.padding.bottom-l.parent.border.top-l.parent.border.bottom};let m=s.clientX-l.parent.left-l.parent.padding.left-l.parent.border.left-l.elem.margin.left,L=s.clientY-l.parent.top-l.parent.padding.top-l.parent.border.top-l.elem.margin.top;o||(m-=l.elem.width/p/2,L-=l.elem.height/p/2);const x={x:m/y.width*(y.width*a),y:L/y.height*(y.height*a)};return A(a,{...g,animate:!1,focal:x},b)}function U(a,s){a.preventDefault();const g={...t,...s,animate:!1},b=(a.deltaY===0&&a.deltaX?a.deltaX:a.deltaY)<0?1:-1,l=u(p*Math.exp(b*g.step/3),g).scale;return Y(l,a,g,a)}function z(a){const s={...t,animate:!0,force:!0,...a};p=u(s.startScale,s).scale;const g=h(s.startX,s.startY,p,s);return v=g.x,w=g.y,i("panzoomreset",s)}let c,E,C,X,R,K;const P=[];function Z(a){if(De(a.target,t))return;le(P,a),S=!0,t.handleStartEvent(a),c=v,E=w,B("panzoomstart",{x:v,y:w,scale:p,isSVG:o,originalEvent:a},t);const s=de(P);C=s.clientX,X=s.clientY,R=p,K=ne(P)}function H(a){if(!S||c===void 0||E===void 0||C===void 0||X===void 0)return;le(P,a);const s=de(P),g=P.length>1;let b=p;if(g){K===0&&(K=ne(P));const l=ne(P)-K;b=u(l*t.step/80+R).scale,Y(b,s,{animate:!1},a)}(!g||t.pinchAndPan)&&N(c+(s.clientX-C)/b,E+(s.clientY-X)/b,{animate:!1},a)}function j(a){P.length===1&&B("panzoomend",{x:v,y:w,scale:p,isSVG:o,originalEvent:a},t),Me(P,a),S&&(S=!1,c=E=C=X=void 0)}let J=!1;function se(){J||(J=!0,re("down",t.canvas?n:e,Z),re("move",document,H,{passive:!0}),re("up",document,j,{passive:!0}))}function ye(){J=!1,ae("down",t.canvas?n:e,Z),ae("move",document,H),ae("up",document,j)}return t.noBind||se(),{bind:se,destroy:ye,eventNames:F,getPan:()=>({x:v,y:w}),getScale:()=>p,getOptions:()=>Ke(t),handleDown:Z,handleMove:H,handleUp:j,pan:N,reset:z,resetStyle:f,setOptions:d,setStyle:(a,s)=>$(e,a,s),zoom:A,zoomIn:O,zoomOut:M,zoomToPoint:Y,zoomWithWheel:U}}ge.defaultOptions=ve;const Qe={class:"sketch-ruler"},qe={class:"canvasedit"},we=r.defineComponent({__name:"index",props:ze,emits:["onCornerClick","update:scale"],setup(e,{expose:t,emit:o}){const n=e,f=o,d=r.ref(null),v=r.ref(0),w=r.ref(0),p=r.ref(0),S=r.ref(0),B=r.ref(1),i=r.ref(n.isShowReferLine),h=r.ref(null),u=r.computed(()=>{function c(C,X){return Object.keys(C).forEach(R=>{R&&C.hasOwnProperty(R)&&(typeof X[R]=="object"?C[R]=c(C[R],X[R]):X.hasOwnProperty(R)&&(C[R]=X[R]))}),C}return c({bgColor:"rgba(225,225,225, 0)",longfgColor:"#BABBBC",fontColor:"#7D8694",shadowColor:"#E8E8E8",lineColor:"#EB5648",borderColor:"#DADADC",cornerActiveColor:"rgb(235, 86, 72, 0.6)",menu:{bgColor:"#fff",dividerColor:"#DBDBDB",listItem:{textColor:"#415058",hoverTextColor:"#298DF8",disabledTextColor:"rgba(65, 80, 88, 0.4)",bgColor:"#fff",hoverBgColor:"#F2F2F2"}}},n.palette||{})}),N=r.computed(()=>({backgroundImage:i.value?`url(${n.eyeIcon||Oe})`:`url(${n.closeEyeIcon||Ye})`,width:n.thick+"px",height:n.thick+"px",borderRight:`1px solid ${u.value.borderColor}`,borderBottom:`1px solid ${u.value.borderColor}`})),A=r.computed(()=>({background:"#ff9",marginTop:n.thick+"px",marginLeft:n.thick+"px",width:n.width-n.thick+"px",height:n.height-n.thick+"px"}));r.onMounted(()=>{k()});const k=()=>{d.value=document.querySelector(".canvasedit"),O(),console.log(p.value,"zoomStartX.value"),console.log(S.value,"zoomStartY.value"),h.value=ge(d.value,{noBind:!0,startScale:n.scale,cursor:"default",startX:p.value,startY:S.value,smoothScroll:!0,...n.panzoomOption}),d.value.addEventListener("panzoomchange",c=>{const{scale:E,dimsOut:C}=c.detail;if(C){console.log(c.detail,"event.detail"),f("update:scale",E),B.value=E;const X=(C.parent.left-C.elem.left)/E,R=(C.parent.top-C.elem.top)/E;v.value=X,console.log(v.value*E,"startX.value"),console.log(E,"scale"),w.value=R}}),parent.addEventListener("wheel",function(c){(c.ctrlKey||c.metaKey)&&h.value.zoomWithWheel(c)}),parent.addEventListener("keydown",function(c){c.key===" "&&h.value.bind()}),parent.addEventListener("keyup",function(c){c.key===" "&&h.value.destroy()})},O=()=>{const E=document.querySelector(".canvasedit-parent").getBoundingClientRect(),C=d.value.children[0].getBoundingClientRect(),{width:X,height:R}=E;X>C.width?(p.value=(X-n.thick-C.width)/2,R>C.height?S.value=(R-n.thick-C.height)/2:S.value=0):(S.value=0,p.value=0)},M=()=>{h.value.reset()},Y=()=>{h.value.zoomIn()},U=()=>{h.value.zoomOut()},z=()=>{i.value=!i.value,f("onCornerClick",i.value)};return r.watch([()=>n.isShowReferLine],()=>{i.value=n.isShowReferLine}),t({panzoomInstance:h,reset:M,zoomIn:Y,zoomOut:U}),(c,E)=>(r.openBlock(),r.createElementBlock("div",Qe,[r.renderSlot(c.$slots,"btn",{reset:M,zoomIn:Y,zoomOut:U}),r.createElementVNode("div",{class:"canvasedit-parent",style:r.normalizeStyle(A.value),onWheel:E[0]||(E[0]=r.withModifiers(()=>{},["prevent"]))},[r.createElementVNode("div",qe,[r.renderSlot(c.$slots,"default")])],36),r.createVNode(ue,{vertical:!1,width:c.width,height:c.thick,"is-show-refer-line":i.value,thick:c.thick,ratio:c.ratio,start:v.value,lines:c.lines.h,"select-start":c.shadow.x,"select-length":c.shadow.width,scale:B.value,palette:u.value,endNumX:c.endNumX},null,8,["width","height","is-show-refer-line","thick","ratio","start","lines","select-start","select-length","scale","palette","endNumX"]),r.createVNode(ue,{vertical:!0,width:c.thick,height:c.height,"is-show-refer-line":i.value,thick:c.thick,ratio:c.ratio,start:w.value,lines:c.lines.v,"select-start":c.shadow.y,"select-length":c.shadow.height,scale:B.value,palette:u.value,endNumY:c.endNumY},null,8,["width","height","is-show-refer-line","thick","ratio","start","lines","select-start","select-length","scale","palette","endNumY"]),r.createElementVNode("a",{class:"corner",style:r.normalizeStyle(N.value),onClick:z},null,4)]))}});exports.SketchRule=we;exports.default=we;
